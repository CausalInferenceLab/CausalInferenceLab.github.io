<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Eunhee &amp; Sangdon">
<meta name="dcterms.date" content="2024-01-19">
<meta name="description" content="Introduction to Causal Inference ê°•ì˜ chapter 8 ì†Œê°œ">

<title>PseudoLab Causal Inference Team - 09. Unobserved Confounding Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="PseudoLab Causal Inference Team">
<meta property="og:description" content="ë°ì´í„° ë¶„ì„ê°€ê°€ ì¸ê³¼ì¶”ë¡ ì„ ê³µë¶€í•˜ê³  ì‹¤ë¬´ì— ì ìš©í•˜ë©´ì„œ ëŠë‚€ ìƒê°ì„ ì •ë¦¬í•œ ìë£Œì…ë‹ˆë‹¤.">
<meta property="og:image" content="https://github.com/CausalInferenceLab/CausalInferenceLab.github.io/posts/Introduction_to_causal_inference_Unobserved_confounding_Analysis/images/pseudo_lab_eng.png">
<meta property="og:site-name" content="PseudoLab Causal Inference Team">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/causal_inference_team_logo.jpg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">PseudoLab Causal Inference Team</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">about</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://causalinferencelab.github.io/" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">09. Unobserved Confounding Analysis</h1>
                  <div>
        <div class="description">
          <p>Introduction to Causal Inference ê°•ì˜ chapter 8 ì†Œê°œ</p>
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Unobserved Confounding Analysis</div>
                <div class="quarto-category">Sensitivity Analysis</div>
                <div class="quarto-category">Sensemakr</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Eunhee &amp; Sangdon </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 19, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#contents" id="toc-contents" class="nav-link active" data-scroll-target="#contents">Contents</a></li>
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#bounds" id="toc-bounds" class="nav-link" data-scroll-target="#bounds">Bounds</a>
  <ul class="collapse">
  <li><a href="#observational-counterfactual-decomposition" id="toc-observational-counterfactual-decomposition" class="nav-link" data-scroll-target="#observational-counterfactual-decomposition">Observational-Counterfactual Decomposition</a></li>
  <li><a href="#no-assumptions-bound" id="toc-no-assumptions-bound" class="nav-link" data-scroll-target="#no-assumptions-bound">[1] No-Assumptions Bound</a></li>
  <li><a href="#monotone-treatment-response-mtr" id="toc-monotone-treatment-response-mtr" class="nav-link" data-scroll-target="#monotone-treatment-response-mtr">[2] Monotone Treatment Response (MTR)</a></li>
  <li><a href="#monotone-treatment-selection-mts" id="toc-monotone-treatment-selection-mts" class="nav-link" data-scroll-target="#monotone-treatment-selection-mts">[3]Monotone Treatment Selection (MTS)</a></li>
  <li><a href="#optimal-treatment-selection-ots" id="toc-optimal-treatment-selection-ots" class="nav-link" data-scroll-target="#optimal-treatment-selection-ots">[4]Optimal Treatment Selection (OTS)</a></li>
  </ul></li>
  <li><a href="#unobserved-confoundingì´-ê³¼ì—°-ê´€ì¸¡-ì—°êµ¬ì—ë§Œ-ì ìš©ë˜ëŠ”-ì´ìŠˆì¼ê¹Œ" id="toc-unobserved-confoundingì´-ê³¼ì—°-ê´€ì¸¡-ì—°êµ¬ì—ë§Œ-ì ìš©ë˜ëŠ”-ì´ìŠˆì¼ê¹Œ" class="nav-link" data-scroll-target="#unobserved-confoundingì´-ê³¼ì—°-ê´€ì¸¡-ì—°êµ¬ì—ë§Œ-ì ìš©ë˜ëŠ”-ì´ìŠˆì¼ê¹Œ">Unobserved Confoundingì´ ê³¼ì—° ê´€ì¸¡ ì—°êµ¬ì—ë§Œ ì ìš©ë˜ëŠ” ì´ìŠˆì¼ê¹Œ?</a></li>
  <li><a href="#sensitivity-analysis" id="toc-sensitivity-analysis" class="nav-link" data-scroll-target="#sensitivity-analysis">Sensitivity analysis</a>
  <ul class="collapse">
  <li><a href="#sensitivity-basiscs-in-linear-setting" id="toc-sensitivity-basiscs-in-linear-setting" class="nav-link" data-scroll-target="#sensitivity-basiscs-in-linear-setting">Sensitivity Basiscs in Linear Setting</a></li>
  <li><a href="#sensitivity-contour-plots" id="toc-sensitivity-contour-plots" class="nav-link" data-scroll-target="#sensitivity-contour-plots">Sensitivity Contour Plots</a></li>
  <li><a href="#more-general-settings" id="toc-more-general-settings" class="nav-link" data-scroll-target="#more-general-settings">More General Settings</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">




<p>ì•ˆë…•í•˜ì„¸ìš”, ê°€ì§œì—°êµ¬ì†Œ Causal Inference íŒ€ì˜ ìµœì€í¬, ê¹€ìƒëˆì…ë‹ˆë‹¤.&nbsp;</p>
<p>Introduction to Causal Inference ê°•ì˜ì˜ ì—¬ëŸë²ˆì§¸ ì±•í„°ì´ë©°, í•´ë‹¹ ì±•í„°ì—ì„œ ë‹¤ë£¨ëŠ” ë‚´ìš©ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p>
<p>ê°•ì˜ ì˜ìƒ ë§í¬ : <a href="https://youtu.be/IXNMYqUsBBQ" class="uri">https://youtu.be/IXNMYqUsBBQ</a></p>
<p>&nbsp; &nbsp; ì‘ì„±ëœ ë‚´ìš© ì¤‘ ê°œì„ ì ì´ë‚˜ ì˜ëª»ëœ ë¶€ë¶„ì´ ìˆë‹¤ë©´ ëŒ“ê¸€ë¡œ ì•Œë ¤ì£¼ì„¸ìš”!</p>
<hr>
<section id="contents" class="level2">
<h2 class="anchored" data-anchor-id="contents">Contents</h2>
<ul>
<li>&nbsp;Overview
<ul>
<li>Potential Outcomes, ATE ë¦¬ë§ˆì¸ë“œ</li>
</ul></li>
<li>Bounds
<ul>
<li>Observational-Counterfactual Decomposition</li>
<li>No-Assumptions Bound</li>
<li>Monotone Treatment Response (MTR)</li>
<li>Monotone Treatment Selection (MTS)</li>
<li>Optimal Treatment Selection (OTS)</li>
</ul></li>
<li>Sensitivity Analysis
<ul>
<li>Linear Single Confounder</li>
<li>Towards More General Settings</li>
</ul></li>
</ul>
</section>
<section id="overview" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<ol type="1">
<li>Potential outcomes</li>
</ol>
<ul>
<li>ì‹¤ì œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¬¸ì œë¥¼ í•´ê²°í•  ë•Œ ìš°ë¦¬ê°€ ê°€ì§„ Control groupì„ í™œìš©í•˜ì—¬ ê´€ì¸¡ë˜ì§€ ì•Šì€ Counterfactual(Unobserved confounders)ê³¼ ìµœëŒ€í•œ ê°™ì•„ì§€ê²Œ í•´ì•¼í•¨</li>
<li>ì¸ê³¼ì¶”ë¡ ì˜ Consistency ì›ì¹™ (ë™ì¼ Tì˜ ê²½ìš° ê·¸ì— ëŒ€í•œ ê²°ê³¼ë„ ë™ì¼í•´ì•¼í•¨)Potential Outcomes
<ul>
<li>í•˜ì–€ ìƒì¥ì˜ ê²½ìš° Consistí•˜ì§€ ì•Šê³  Counterfactualí•¨ (ì´ëŸ° ê²½ìš°ê°€ ë°”ë¡œ unobserved confounding factors)</li>
</ul></li>
</ul>
<p><img src="img1.png" class="img-fluid"></p>
<p>2. ATEì— ëŒ€í•´ ë‹¤ì‹œ í•œë²ˆ ì§šì–´ë³´ì.</p>
<p><span class="math inline">\(\mathbb{E}[Y(1)-Y(0)]=\mathbb{E}_W[\mathbb{E}[Y\,|\, T=1,W]-\mathbb{E}[Y\,|\, T=0,W]]\)</span></p>
<ul>
<li>What is ATE(Average Treatment Effect)?
<ul>
<li>ì¼ë°˜ì ìœ¼ë¡œ A/B testingì—ì„œ ì‚¬ìš©ë˜ëŠ” ë¶„ì„ ë°©ë²•. ê°œì¸ì˜ ì¸ê³¼íš¨ê³¼ë¥¼ í‰ê· ì„ ë‚´ì–´ ì§‘ë‹¨ ë ˆë²¨ì—ì„œ ì„¤ëª…. ë³´í†µì˜ ê²½ìš° êµë€ë³€ìˆ˜(Confounders) <span class="math inline">\(W\)</span>ê°€ ê´€ì¸¡ë  ê²½ìš° ì²˜ì¹˜ <span class="math inline">\(T\)</span>(treatment)ì™€ ê²°ê³¼ <span class="math inline">\(Y\)</span>ì— ëŒ€í•œ ì¸ê³¼ë¥¼ ì•„ë˜ì™€ ê°™ì€ ATE ì‹ì„ ê¸°ë°˜ìœ¼ë¡œ ì„¤ëª…í•  ìˆ˜ ìˆìŒ</li>
<li>ìœ„ ATEì‹ì´ ì„±ë¦½ ê°€ëŠ¥í•œ ê²½ìš°: Confounderê°€ ëª¨ë“  ê·¸ë£¹ì— ë™ì¼í•˜ê²Œ ì‘ìš©í• ë•Œ ë‘ ê·¸ë£¹ì— Confounding factorsê°€ ë™ì§ˆí•˜ê²Œ ì‘ìš©í•˜ê¸° ìœ„í•´ì„ ? RCTë¥¼ í†µí•´ ê°€ëŠ¥!</li>
</ul></li>
</ul>

<div class="no-row-height column-margin column-container"><div class="">
<p><img src="img2.png" class="img-fluid"></p>
</div></div><ul>
<li>í•˜ì§€ë§Œ ATEì˜ ê²½ìš° Outlierì— ì·¨ì•½í•œ ë‹¨ì  ë˜í•œ ìˆìŒ
<ul>
<li>e.g.&nbsp;íƒ€ê²Ÿêµ°ê³¼ ëŒ€ì¡°êµ°ì˜ ë§¤ì¶œ ë¹„êµ ì§„í–‰ ì‹œ, ë§Œì•½ ëŒ€ì¡°êµ°ì— íƒ€ê²Ÿêµ°ì˜ êµ¬ë§¤ì•¡ì„ í•©ì¹œ ìˆ˜ì¤€ì˜ í•µê³¼ê¸ˆëŸ¬ê°€ í•œ ëª…ì´ë¼ë„ ì¡´ì¬í•œë‹¤ë©´?</li>
</ul></li>
</ul>

<div class="no-row-height column-margin column-container"><div class="">
<p><img src="img3.png" class="img-fluid"></p>
</div></div><ul>
<li>Identify a point [Identification]
<ul>
<li>ëª¨ë“  ë³€ìˆ˜ê°€ ê´€ì¸¡ê°€ëŠ¥í•˜ë‹¤ê³  ê°•í•œ ê°€ì •ì„ í•œë‹¤ë©´, ìš°ë¦¬ëŠ” í¬ì¸íŠ¸ê°€ ë˜ëŠ” ì§€ì ì„ ëª…í™•íˆ ì•Œ ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.</li>
</ul></li>
</ul>
<p>3. ë§Œì•½ ê´€ì¸¡ ë¶ˆê°€(Unobserved Confounders)í•œ <span class="math inline">\(U\)</span>ë¥¼ ë°œê²¬í•˜ì˜€ì„ë• ì–´ë–¡í•´ì•¼ í• ê¹Œ?</p>
<ul>
<li>ì‚¬ì‹¤ ê´€ì¸¡ ë¶ˆê°€í•œ <span class="math inline">\(U\)</span>ëŠ” ê±°ì˜ ëª¨ë“  ì—°êµ¬ì—ì„œ ê³ ë ¤í•´ì•¼í•  ì‚¬í•­</li>
</ul>
<p><span class="math inline">\(\begin{aligned}\mathbb{E}[Y(1)-Y(0)] &amp;=\mathbb{E}_W,_U[\mathbb{E}[Y\,|\, T=1,W,U]-\mathbb{E}[Y\,|\, T=0,W,U]] \\ &amp;\approx \mathbb{E}_W[\mathbb{E}[Y\,|\, T=1,W]-\mathbb{E}[Y\,|\, T=0,W]]\end{aligned}\)</span></p>
<ul>
<li>Identify an interval (Partial identification)
<ul>
<li>ATEë¥¼ í™œìš©í•˜ì—¬ ìµœëŒ€í•œ ê·¼ì‚¬ì¹˜ë¥¼ ì°¾ì•„ë³´ì</li>
<li>í•œê°€ì§€ ê°€ì •ì„ ë‚´ë¦¬ëŠ” ê²ƒì´ ì•„ë‹Œ ê°€ì •ì˜ ë²”ìœ„ë¥¼ ë„“í˜€ [ê·¼ì‚¬ì¹˜], ì¦‰ ê·¸ ê°„ê²©(Interval)ì„ ì¶”ì •í•´ë³´ì</li>
</ul></li>
</ul>

<div class="no-row-height column-margin column-container"><div class="">
<p><img src="img4.png" class="img-fluid"></p>
</div></div><blockquote class="blockquote">
<p>ğŸ’¡&nbsp;â€˜No&nbsp;Unobserved&nbsp;Confoundingâ€™&nbsp;is&nbsp;Unrealistic.<br>
&nbsp; &nbsp;í˜„ì‹¤ ì„¸ê³„ì—ì„œ ëª¨ë“  ë³€ìˆ˜ë¥¼ ê´€ì¸¡í•œë‹¤ëŠ” ê²ƒì€ ë¶ˆê°€ëŠ¥í•˜ë‹¤.</p>
</blockquote>
<table class="table">
<colgroup>
<col style="width: 4%">
<col style="width: 27%">
<col style="width: 52%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th>1</th>
<th><strong>No-Assumptions Bound</strong></th>
<th>ê°€ì •ì´ ì—†ë‹¤.</th>
<th>Interval ë§¤ìš° ê¹€</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td><strong>Monotone Treatment Response</strong></td>
<td>ì²˜ì¹˜(<span class="math inline">\(T\)</span>)ëŠ” ì–¸ì œë‚˜ ê²°ê³¼(<span class="math inline">\(Y\)</span>)ì— ì˜í–¥ì„ ì¤€ë‹¤.</td>
<td>&nbsp;</td>
</tr>
<tr class="even">
<td>3</td>
<td><strong>Monotone Treatment Selection</strong></td>
<td>ì²˜ì¹˜(<span class="math inline">\(T\)</span>)ë¥¼ ë°›ì€ êµ°ì´ ì–¸ì œë‚˜ ì¢‹ì€ Potential Outcomesì„ ë„ì¶œí•œë‹¤.</td>
<td>&nbsp;</td>
</tr>
<tr class="odd">
<td>4</td>
<td><strong>Optimal Treatment Selection</strong></td>
<td>ê°œê°œì¸ì€ ì–¸ì œë‚˜ ìµœì ì˜ ì²˜ì¹˜(<span class="math inline">\(T\)</span>)ë¥¼ ë°›ëŠ”ë‹¤.</td>
<td>- Interval ì§§ì•„ì§</td>
</tr>
</tbody>
</table>
<p>ğŸ‘‰ ê°€ì •ì˜ ì •ë„ê°€ ì˜¬ë¼ê°ˆìˆ˜ë¡ í˜„ì‹¤ ì„¸ê³„ì—ì„œ ë°œìƒë˜ëŠ” í˜„ìƒì— ëŒ€í•œ ì„¤ëª…ë ¥ì´ ë–¨ì–´ì§„ë‹¤ëŠ” í•œê³„ì ì´ ì¡´ì¬í•œë‹¤. ê°•í•œ ê°€ì • ì•„ë˜ì—ì„œ ë‚˜ì˜¨ ê²°ë¡ ì¼ìˆ˜ë¡ ê·¸ ê²°ê³¼ì˜ ì‹ ë¢°ì„±ì„ ë–¨ì–´ì§„ë‹¤ëŠ” ëœ». (â€œThe credibility of inference decreases with the strength the assumptions maintained.â€ Manski)</p>
<p>ğŸ‘‰ Intervalì´ ì§§ì•„ì§ˆìˆ˜ë¡ ê²°ê³¼ì— ëŒ€í•œ ì‹ ë¢°ë„ë„ ë–¨ì–´ì§ˆ ìˆ˜ ìˆìŒ (ê°œê°œì¸ì´ ì–¸ì œë‚˜ ìµœì ì˜ ì²˜ì¹˜ë¥¼ ë°›ì„ í™•ë¥ ì€?)</p>
</section>
<section id="bounds" class="level2">
<h2 class="anchored" data-anchor-id="bounds">Bounds</h2>
<blockquote class="blockquote">
<p>&nbsp;ğŸ’¡&nbsp;ì§€ê¸ˆë¶€í„°&nbsp;ê´€ì¸¡ì´&nbsp;ì–´ë ¤ìš´&nbsp;ë³€ìˆ˜ë“¤ì˜&nbsp;ë²”ìœ„ë¥¼&nbsp;ì¢íˆëŠ”&nbsp;ë°©ë²•ë¡ ë“¤ì—&nbsp;ëŒ€í•´&nbsp;ì•Œì•„ë´ë³´ì.</p>
</blockquote>
<section id="observational-counterfactual-decomposition" class="level3">
<h3 class="anchored" data-anchor-id="observational-counterfactual-decomposition">Observational-Counterfactual Decomposition</h3>
<p>ì´ì¯¤ì—ì„œ ë‹¤ì‹œë³´ëŠ” ATE. <span class="math inline">\(\mathbb{E}[Y(1)-Y(0)]=\mathbb{E}_W[\mathbb{E}[Y\,|\, T=1,W]-\mathbb{E}[Y\,|\, T=0,W]]\)</span></p>
<ul>
<li>Observational : ê´€ì¸¡ë˜ëŠ” ë¶€ë¶„</li>
<li>Counterfactual : ê°€ì •ì„ í†µí•´ ë²”ìœ„ë¥¼ ì¢íˆëŠ” ë¶€ë¶„</li>
</ul>
<p><img src="img5.png" class="img-fluid"></p>
<blockquote class="blockquote">
<p>ğŸ’¡Observational-Counterfactual Decomposition<br>
<span class="math inline">\(\begin{aligned}\mathbb{E}[Y(1)-Y(0)] = \pi\mathbb{E}[Y|T=1] + (1-\pi)\mathbb{E}[Y(1)|T=0] \\ -\,\pi\mathbb{E}[Y(0)|T=1] - (1-\pi)\mathbb{E}[Y|T=0] \\ where&nbsp;\;\;&nbsp;\pi&nbsp;\triangleq&nbsp;P(T=1)\end{aligned}\)</span></p>
</blockquote>
</section>
<section id="no-assumptions-bound" class="level3">
<h3 class="anchored" data-anchor-id="no-assumptions-bound">[1] No-Assumptions Bound</h3>
<ul>
<li>ê°€ì •: ë²”ìœ„(Bound)ì— ëŒ€í•œ ê°€ì •ì´ ì—†ì„ ë•Œ Interval Length êµ¬í•´ë³´ê¸°</li>
</ul>
<p><strong>Bounded Potential Outcomes</strong></p>
<p><span class="math inline">\(Y(0)\)</span>ê³¼ <span class="math inline">\(Y(1)\)</span>ì´ <span class="math inline">\(0\)</span>ê³¼ <span class="math inline">\(1\)</span> ì‚¬ì´ì— ìˆë‹¤ê³  ê°€ì •í–ˆì„ ë•Œ <span class="math inline">\(\mathbb{E}Y(1)-Y(0)\)</span>ì˜ ê²½ìš° ìŒì˜ 0ê³¼ 1, ì–‘ì˜ 0ê³¼ 1 ì‚¬ì´ì— ìˆë‹¤.</p>
<p><span class="math inline">\(-1 \le \mathbb{E}[Y(1)-Y(0)] \le 1\)</span></p>
<p>ì´ë¥¼ ì¼ë°˜í™”í•œë‹¤ë©´, <span class="math inline">\(\forall t, a \le Y(t) \le b\)</span></p>
<p><span class="math display">\[ a-b \le \mathbb{E}[Y(1)-Y(0)] \le b-a \]</span></p>
<ul>
<li>Trival length limit : <span class="math inline">\(2(b-a)\)</span></li>
</ul>
<p><strong>No-Assumptions Bound</strong></p>
<ul>
<li>observational-counterfactual decomposition ì™€ ê° ë°©ë²•ë¡ ì˜ ê°€ì •ì„ í™œìš©í•˜ì—¬ lower boundì™€ upper boundë¥¼ ì¶”ì •í•˜ëŠ” ê³¼ì •
<ul>
<li>upper bound
<ul>
<li><span class="math inline">\(\mathbb{E}[Y(1)-Y(0)] \le \pi\mathbb{E}[Y|T=1]+(1-\pi)b -\pi a-(1-\pi)\mathbb{E}[Y|T=0]\)</span></li>
</ul></li>
<li>lower bound
<ul>
<li><span class="math inline">\(\mathbb{E}[Y(1)-Y(0)] \ge \pi\mathbb{E}[Y|T=1]+(1-\pi)a -\pi b-(1-\pi)\mathbb{E}[Y|T=0]\)</span><span class="math display">\[ Interval\; Length = b-a \]</span></li>
</ul></li>
</ul></li>
<li>ìµœì´ˆì˜ ì‹œì‘ì—ì„œ ë²”ìœ„ë¥¼ ë°˜ìœ¼ë¡œ ì¤„ì´ê²Œ ë˜ëŠ” ê²ƒ. <span class="math inline">\(2(b-a) \longrightarrow b-a\)</span></li>
<li>ì–¸ì œë‚˜ 0ì„ í¬í•¨í•œë‹¤.</li>
</ul>
<blockquote class="blockquote">
<p>ğŸ’¡ (ì•ìœ¼ë¡œ ê³„ì† ë‚˜ì˜¬) ì˜ˆì‹œ<br>
(1) Potential outcomes ê°€ <span class="math inline">\(0(a)\)</span> ì™€ <span class="math inline">\(1(b)\)</span> ì‚¬ì´ì— ìˆìŒ<br>
(2) <span class="math inline">\(\pi = 0.3\)</span> <span class="math inline">\(\mathbb{E}[Y|T=1]=0.9\)</span> <span class="math inline">\(\mathbb{E}[Y|T=0]=0.2\)</span><br>
<span class="math display">\[ -0.17 \le \mathbb{E}[Y(1)-Y(0)] \le 0.83 \]</span></p>
</blockquote>
</section>
<section id="monotone-treatment-response-mtr" class="level3">
<h3 class="anchored" data-anchor-id="monotone-treatment-response-mtr">[2] Monotone Treatment Response (MTR)</h3>
<blockquote class="blockquote">
<p>ê°€ì •: ì²˜ì¹˜(T)ëŠ” ì–¸ì œë‚˜ ê²°ê³¼(Y)ì— ì˜í–¥ì„ ì¤€ë‹¤ëŠ” ê°€ì • (Nonnegative, Nonpositive)</p>
</blockquote>
<table class="table">
<colgroup>
<col style="width: 49%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Nonnegative MTR</th>
<th>Nonpositive MTR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(\forall i\; Y_i(1) \ge Y_i(0)\)</span></td>
<td><span class="math inline">\(\forall i\; Y_i(1) \le Y_i(0)\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(0&nbsp;\le&nbsp;\mathbb{E}[Y(1)-Y(0)]&nbsp;\le&nbsp;0.83\)</span></td>
<td><span class="math inline">\(-0.17 \le \mathbb{E}[Y(1)-Y(0)] \le 0\)</span></td>
</tr>
</tbody>
</table>
<ol type="1">
<li>Nonnegative MTR (lower bound ë¬´ì‹œ)
<ul>
<li>ì²˜ì¹˜ëŠ” ì–¸ì œë‚˜ ê²°ê³¼ì— ê¸ì •ì ì¸ ì˜í–¥ì„ ì¤€ë‹¤.</li>
</ul></li>
</ol>
<p><span class="math inline">\(\forall i\; Y_i(1) \ge Y_i(0)\)</span></p>
<ul>
<li>ITE (Individual Treatment Effect) <span class="math inline">\(a - b \ge 0\)</span></li>
<li>ATE (Average Treatment Effect) <span class="math inline">\(\mathbb{E}[Y(1)-Y(0)] \ge 0\)</span></li>
</ul>
<ol type="1">
<li>Nonpositive MTR (upper bound ë¬´ì‹œ)
<ul>
<li>ì²˜ì¹˜ëŠ” ì–¸ì œë‚˜ ê²°ê³¼ì— ë¶€ì •ì ì¸ ì˜í–¥ì„ ì¤€ë‹¤.&nbsp;</li>
</ul></li>
</ol>
<p><span class="math inline">\(\forall i\; Y_i(1) \le Y_i(0)\)</span></p>
<ul>
<li>ITE (Individual Treatment Effect) <span class="math inline">\(a - b \le 0\)</span></li>
<li>ATE (Average Treatment Effect) <span class="math inline">\(\mathbb{E}[Y(1)-Y(0)] \le 0\)</span></li>
</ul>
</section>
<section id="monotone-treatment-selection-mts" class="level3">
<h3 class="anchored" data-anchor-id="monotone-treatment-selection-mts">[3]Monotone Treatment Selection (MTS)</h3>
<blockquote class="blockquote">
<p>ê°€ì •: ì²˜ì¹˜(<span class="math inline">\(T\)</span>)ë¥¼ ë°›ì€ íƒ€ê²Ÿêµ°(Target)ì´ ëŒ€ì¡°êµ°(Control)ë³´ë‹¤ ì–¸ì œë‚˜ ì¢‹ì€ Potential Outcomes ë„ì¶œí•œë‹¤. (MTS Upper Bound)</p>
</blockquote>
<ul>
<li><span class="math inline">\(\mathbb{E}[Y(1)|T=1] \ge \mathbb{E}[Y(1)|T=0]\)</span></li>
<li><span class="math inline">\(\mathbb{E}[Y(0)|T=1] \ge \mathbb{E}[Y(0)|T=0]\)</span></li>
</ul>
<p><span class="math display">\[ \mathbb{E}[Y(1)-Y(0)] \le \mathbb{E}[Y|T=1] - \mathbb{E}[Y|T=0] \]</span></p>
<blockquote class="blockquote">
<p>ğŸ’¡ ê·¸ëŸ¬ë©´ ì´ì œ MTS Upper Boundì— nonnegative MTRì„ í•©ì³ë³´ì.<br>
ì´ë¥¼ í†µí•´ ìš°ë¦¬ëŠ” ë” ì¢ì€ Interval lengthë¥¼ ê²Ÿí•  ìˆ˜ ìˆë‹¤!</p>
</blockquote>
<table class="table">
<thead>
<tr class="header">
<th>No Assumptions</th>
<th><span class="math inline">\(-0.17 \le \mathbb{E}[Y(1)-Y(0)] \le 0.83\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>MTS Upper Bound</td>
<td><span class="math inline">\(-0.17 \le \mathbb{E}[Y(1)-Y(0)] \le 0.7\)</span></td>
</tr>
<tr class="even">
<td>nonnegative MTR</td>
<td><span class="math inline">\(0 \le \mathbb{E}[Y(1)-Y(0)] \le 0.83\)</span></td>
</tr>
<tr class="odd">
<td>do combine. (MTS + MTR)</td>
<td><span class="math inline">\(0 \le \mathbb{E}[Y(1)-Y(0)] \le 0.7\)</span></td>
</tr>
</tbody>
</table>
</section>
<section id="optimal-treatment-selection-ots" class="level3">
<h3 class="anchored" data-anchor-id="optimal-treatment-selection-ots">[4]Optimal Treatment Selection (OTS)</h3>
<blockquote class="blockquote">
<p>ê°€ì •: ê°œê°œì¸ì€ ì–¸ì œë‚˜ ê·¸ë“¤ì—ê²Œ ìµœì ì˜ ì²˜ì¹˜(Optimal Treatment)ë¥¼ ë°›ëŠ”ë‹¤.</p>
</blockquote>
<blockquote class="blockquote">
<p>ğŸ’¡ OTS Assumption<br>
(1) Treatment Group (íƒ€ê²Ÿêµ°) <span class="math inline">\(T_i = 1 \Longrightarrow Y_i(1) \ge Y_i(0)\)</span><br>
(2) Nontreatment Group (ëŒ€ì¡°êµ°) <span class="math inline">\(T_i = 0 \Longrightarrow Y_i(0) &gt; Y_i(1)\)</span>&nbsp;</p>
</blockquote>
<p><strong>[4-1] ë°©ë²•ë¡ 1</strong></p>
<p>observational-counterfactual decomposition</p>
<ul>
<li>OTS Upper Bound 1 : <span class="math inline">\(\mathbb{E}[Y(1)|T=0] \le \mathbb{E}[Y|T=0]\)</span></li>
<li>OTS Lower Bound 2 : <span class="math inline">\(-\mathbb{E}[Y(0)|T=1] \ge -\mathbb{E}[Y|T=1]\)</span></li>
</ul>
<p><span class="math display">\[ Interval\; Length = \pi\mathbb{E}[Y|T=1]+(1-\pi)\mathbb{E}[Y|T=0]-a \]</span></p>
<table class="table">
<thead>
<tr class="header">
<th>No Assumptions</th>
<th><span class="math inline">\(-0.17 \le \mathbb{E}[Y(1)-Y(0)] \le 0.83\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>OTS Bound 1</td>
<td><span class="math inline">\(-0.14 \le \mathbb{E}[Y(1)-Y(0)] \le 0.27\)</span></td>
</tr>
</tbody>
</table>
<p>ì—¬ì „íˆ 0ì„ í¬í•¨í•˜ê³  ìˆëŠ”ë°â€¦..</p>
<p><strong>[4-2] ë°©ë²•ë¡ 2</strong> : Bound the identifies the sign!</p>
<p>observational-counterfactual decomposition</p>
<ul>
<li>OTS Upper Bound 2 : <span class="math inline">\(\mathbb{E}[Y(1)|T=0] \le \mathbb{E}[Y|T=1]\)</span></li>
<li>OTS Lower Bound 2 : ì•Œì•„ì„œ í•´ë³´ë˜ìš”â€¦</li>
</ul>
<table class="table">
<thead>
<tr class="header">
<th>No Assumptions</th>
<th><span class="math inline">\(-0.17 \le \mathbb{E}[Y(1)-Y(0)] \le 0.83\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>OTS Bound 1</td>
<td><span class="math inline">\(-0.14 \le \mathbb{E}[Y(1)-Y(0)] \le 0.27\)</span></td>
</tr>
<tr class="even">
<td>OTS Bound 2</td>
<td><span class="math inline">\(0.07 \le \mathbb{E}[Y(1)-Y(0)] \le 0.76\)</span></td>
</tr>
<tr class="odd">
<td>do combine</td>
<td><span class="math inline">\(0.07 \le \mathbb{E}[Y(1)-Y(0)] \le 0.27\)</span></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="unobserved-confoundingì´-ê³¼ì—°-ê´€ì¸¡-ì—°êµ¬ì—ë§Œ-ì ìš©ë˜ëŠ”-ì´ìŠˆì¼ê¹Œ" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="unobserved-confoundingì´-ê³¼ì—°-ê´€ì¸¡-ì—°êµ¬ì—ë§Œ-ì ìš©ë˜ëŠ”-ì´ìŠˆì¼ê¹Œ">Unobserved Confoundingì´ ê³¼ì—° ê´€ì¸¡ ì—°êµ¬ì—ë§Œ ì ìš©ë˜ëŠ” ì´ìŠˆì¼ê¹Œ?</h2>
<blockquote class="blockquote">
<p>ğŸ’¡ ì‹¤í—˜ ì—°êµ¬(Experimental Study)ì—ì„œ ë°œìƒí•˜ëŠ” Unobserved Confounding factors</p>
</blockquote>
<ul>
<li>ê´€ì¸¡ë˜ì§€ ì•ŠëŠ” êµë€ ë³€ìˆ˜ê°€ RCT ê¸°ë°˜ì˜ ì‹¤í—˜ì—ì„œëŠ” ì „í˜€ ì´ìŠˆê°€ ë˜ì§€ ì•Šì„ê¹Œ?
<ul>
<li>RCT (Randomised Controlled Trial) ëœë¤í™” ì‹¤í—˜ (RCT ìˆ˜í–‰ ëª©ì : ê·¸ë£¹ì˜ ë™ì§ˆì„±)</li>
<li>ìš°ë¦¬ê°€ ì›í•˜ëŠ” ì´ìƒì ì¸ RCT ê¸°ë°˜ A/B testëŠ”â€¦</li>
<li>íƒ€ê²Ÿêµ°ê³¼ ëŒ€ì¡°êµ°ì„ ëœë¤í•˜ê²Œ ë‚˜ëˆ„ì–´ ë™ì§ˆ ê·¸ë£¹(homogeneous group)ìœ¼ë¡œ ë¶„í• í•˜ê³ , íƒ€ê²Ÿêµ°ì—ë§Œ ì²˜ì¹˜(Treatment)ë¥¼ ì§„í–‰í•˜ì—¬ ë‚˜ì˜¨ ê°’ì—ì„œ ëŒ€ì¡°êµ°ì˜ ê°’ì„ ì°¨ê°í•´ì¤€ ê²°ê³¼ëŠ” ì²˜ì¹˜ë¡œ ì¸í•œ ê²°ê³¼ë‹¤! <span class="math inline">\(T \longrightarrow Y\)</span> (ì²˜ì¹˜ì™€ ê²°ê³¼ ì‚¬ì´ì—ëŠ” ì¸ê³¼ê´€ê³„ê°€ ì¡´ì¬í•œë‹¤.)</li>
</ul></li>
</ul>

<div class="no-row-height column-margin column-container"><div class="">
<p><img src="img6.png" class="img-fluid"></p>
</div></div><ul>
<li>(íŠ¹íˆ ë§ˆì¼€íŒ…ì—ì„œ)ì¸ê³¼ì¶”ë¡ ì„ ì˜ ëª¨ë¥´ëŠ” ì˜ì‚¬ê²°ì •ìì˜ í”í•œ ë°˜ë¡ . ì›ë˜ [ìƒí’ˆ/ì´ë²¤íŠ¸/ê¸°ëŠ¥ê°œì„ /ì—…ë°ì´íŠ¸]ê°€ ì´ì „ë³´ë‹¤ ê³ ê°ì—ê²Œ ë§¤ë ¥ì ì´ì–´ì„œ ê·¸ëŸ°ê±° ì•„ëƒ?</li>
<li>í”í•œ ë¶„ì„ê°€ì˜ ì„¤ëª…: íƒ€ê²Ÿêµ°ê³¼ ëŒ€ì¡°êµ° ëª¨ë‘ì—ê²Œ ë™ì§ˆí•˜ê²Œ ì ìš©ë˜ëŠ” ì™¸ë¶€ë³€ìˆ˜ì„.
<ul>
<li>ğŸ¤” ê³¼ì—° ì§„ì§œ ê·¸ëŸ´ê¹Œ? ì˜ì™¸ë¡œ ë‚ ì¹´ë¡œìš´ ì§€ì ì´ì—ˆì„ ìˆ˜ë„</li>
</ul></li>
</ul>

<div class="no-row-height column-margin column-container"><div class="">
<p><img src="img7.png" class="img-fluid"></p>
</div></div><ul>
<li>ë…¼ë¬¸ì†Œê°œ. (Microsoft) Common Metric Interpretation Pitfall in A/B test <a href="https://www.notion.so/Casual-Causality-efb2d821ae334b8d9674ca331edebc72">ì›ë¬¸ì€ ì—¬ê¸°</a></li>
</ul>
<blockquote class="blockquote">
<p>ğŸ’¡ A/B testë¥¼ ì§„í–‰í•  ë•Œ ë°˜ë“œì‹œ ì•„ë˜ 4ê°€ì§€ë¥¼ í™•ì¸í•´ì•¼ í•¨<br>
(1) Data Quality : í™œìš©ëœ ë°ì´í„°ê°€ ì‹ ë¢°í• ë§Œí•œê°€? e.g.&nbsp;íƒ€ê²Ÿêµ°ê³¼ ëŒ€ì¡°êµ°ì˜ ë™ì¼í•œ ëª¨ì§‘ë‹¨ì—ì„œ ëœë¤ ìƒ˜í”Œë§ë˜ì—ˆëŠ”ì§€.<br>
(2) OverallEvaluation Criteria : ì²˜ì¹˜ê°€ ì„±ê³µì ì´ì—ˆëŠ”ì§€, ì„±ê³µí–ˆë‹¤ë©´ ì–´ëŠ ì •ë„ì˜ íš¨ê³¼ì˜€ëŠ”ì§€, ê·¸ íš¨ê³¼ê°€ í†µê³„ì ìœ¼ë¡œ ìœ ì˜í•œì§€<br>
(3) Guardrail : ì‹¤í—˜ì— ì˜í–¥ì„ ì£¼ëŠ” êµë€ì€ ì–´ëŠ ì •ë„ì˜€ëŠ”ê°€ (ì „ì‚¬ì ìœ¼ë¡œ ì˜í–¥ì„ ë°›ìœ¼ë©´ ì•ˆë˜ëŠ” ì§€í‘œ)<br>
(4) Local Feature and Diagnostic : ìœ ì €ì˜ ì•¡ì…˜ì„ ì„¸ë°€í•œ ìˆ˜ì¤€ì—ì„œ ë¶„ì„í•˜ì—¬ ì²˜ì¹˜ì˜ ì„±ê³µ ì—¬ë¶€ì™€ êµë€ ë³€ìˆ˜ì˜ ì˜í–¥ ì •ë„ë¥¼ íŒŒì•…&nbsp;</p>
</blockquote>
<ul>
<li><ul>
<li>ì‚¬ë¡€1. Counfounding factor - Metric Sample Ratio Mismatch(e.g.)
<ul>
<li>ë§í¬ ì´ë™ ë°©ë²•ì— ë”°ë¥¸ ìœ ì € ê²½í—˜ ìµœì í™”</li>
<li>ë§í¬ë¥¼ ìƒˆë¡œìš´ íƒ­ì—ì„œ ë„ìš°ëŠ” ê²ƒì´ í™ˆí˜ì´ì§€ ë¡œë“œ íƒ€ì„ì„ ì¦ê°€ì‹œì¼°ë‹¤ (?)</li>
</ul></li>
</ul></li>
</ul>
<table class="table">
<colgroup>
<col style="width: 7%">
<col style="width: 71%">
<col style="width: 21%">
</colgroup>
<thead>
<tr class="header">
<th>&nbsp;</th>
<th>ê°€ì„¤</th>
<th>ê²°ê³¼ (í˜ì´ì§€ ë¡œë“œ ìˆ˜)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>íƒ€ê²Ÿêµ°</td>
<td>MSN í™ˆí˜ì´ì§€ì—ì„œ í´ë¦­ëœ ì–´ëŠ ë§í¬ë“ , ìƒˆë¡œìš´ íƒ­ìœ¼ë¡œ í˜ì´ì§€ê°€ ëœ¬ë‹¤.</td>
<td>~8.4M</td>
</tr>
<tr class="even">
<td>ëŒ€ì¡°êµ°</td>
<td>MSN í™ˆí˜ì´ì§€ì—ì„œ í´ë¦­ëœ ì–´ëŠ ë§í¬ë“ , ì˜¤í”ˆë˜ì–´ ìˆëŠ” íƒ­ì—ì„œ ë§í¬ë¡œ ì´ë™ëœë‹¤.</td>
<td>~9.2M</td>
</tr>
</tbody>
</table>
<p>ê²°ë¡ : ì‹¤í—˜êµ°(íƒ€ê²Ÿêµ°)ì—ì„œ í˜ì´ì§€ ë¡œë“œ íƒ€ì„ì´ ì•½ 8.32% ì¦ê°€í–ˆë‹¤. -&gt; ê¸°ëŒ€ ì´ìƒì˜ í° ì¦ê°€</p>
<p>ğŸŒŸ&nbsp;<strong>Confounding factor</strong></p>
<ol type="1">
<li><p><strong>í™ˆí˜ì´ì§€ íƒ­ì´ ë¯¸ë¦¬ ì¼œì ¸ ìˆì–´ reloadí•˜ì§€ ì•Šì•„ë„ ë˜ëŠ” ìƒí™©</strong></p></li>
<li><p><strong>ëŒ€ì¡°êµ°ì˜ ê²½ìš° ë¸Œë¼ìš°ì €ì— ë‚¨ì€ í™ˆí˜ì´ì§€ ìºì‹œ</strong></p></li>
</ol>
<p>ğŸ’¡ ì´ëŸ° ìš”ì¸ë“¤ì„ ì–´ë–»ê²Œ ë°œê²¬ í•´ì•¼í• ê¹Œ?</p>
<ol type="1">
<li><p>ë¹„ìœ¨ ì§€í‘œë¥¼ ë¶„í•´í•˜ì—¬ ì–´ëŠ ë¶€ë¶„ì—ì„œ ì°¨ì´ê°€ ë°œìƒí•˜ëŠ”ì§€ íŒŒì•…</p></li>
<li><p>ë¹„ìœ¨ mismatchì— ì˜í–¥ì„ ë°›ì§€ ì•ŠëŠ” ì‹¤í—˜êµ°, ëŒ€ì¡°êµ° ê°„ì˜ ë™ë“±í•˜ê²Œ ë¹„êµí•  ìˆ˜ ìˆëŠ” subsetì„ ì°¾ì•„ì„œ ì‹ ë¢° ê°€ëŠ¥í•œ ê²°ê³¼ë¥¼ ë¶„ì„</p></li>
</ol>
<ul>
<li>ì‚¬ë¡€2. Counfounding factor - Novelty and Primacy Effects
<ul>
<li>(e.g.) CRMì¸¡ë©´ì—ì„œì˜ ê° ì„¸ê·¸ë¨¼íŠ¸ ë³„ ì²˜ì¹˜ì— ë”°ë¥¸ íš¨ê³¼ ì¸¡ì •</li>
<li>ê·¸ë£¹ Aì˜ ì²˜ì¹˜ íš¨ê³¼ê°€ ê·¸ë£¹ Bì˜ ì²˜ì¹˜ íš¨ê³¼ë³´ë‹¤ ì¢‹ì•˜ë‹¤(?)</li>
</ul></li>
</ul>
<table class="table">
<colgroup>
<col style="width: 12%">
<col style="width: 43%">
<col style="width: 43%">
</colgroup>
<thead>
<tr class="header">
<th>&nbsp;</th>
<th>ê·¸ë£¹ A</th>
<th>ê·¸ë£¹ B</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ì²˜ì¹˜ íš¨ê³¼</td>
<td>(ì²˜ì¹˜êµ°ì´ ëŒ€ì¡°êµ°ì— ë¹„í•´) + 126% ìƒìŠ¹</td>
<td>(ì²˜ì¹˜êµ°ì´ ëŒ€ì¡°êµ°ì— ë¹„í•´) + 108% ìƒìŠ¹</td>
</tr>
</tbody>
</table>
<p>ì—¬ê¸°ì„œ ë‚¼ ìˆ˜ ìˆëŠ” ê²°ë¡ : ê·¸ë£¹ Aê°€ CRM ì¸¡ë©´ì—ì„œ ê·¸ë£¹ Bë³´ë‹¤ ë” ì¢‹ì€ ì„¸ê·¸ë¨¼íŠ¸ë‹¤. ê·¸ë£¹ Aë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ í•œ ì „ëµì„ ìˆ˜ë¦½í•´ë³´ì(?)</p>
<p><img src="img8.png" class="img-fluid"></p>
<p><img src="img9.png" class="img-fluid"></p>
<p>ğŸŒŸ&nbsp;<strong>Confounding factor</strong> - ê·¸ë£¹ Aì—ì„œì˜ Novelty effect</p>
<ul>
<li>Novelty effect : ê¸ì •ì ì¸ íš¨ê³¼ê°€ ë‹¨ê¸°ê°„ í˜¹ì€ ì´ˆë°˜ì—ë§Œ ë°œìƒí•˜ê³ , ê¸°ê°„ì´ ê¸¸ì–´ì§ˆìˆ˜ë¡ ê·¸ íš¨ê³¼ê°€ ë‚˜íƒ€ë‚˜ì§€ ì•Šì„ ë•Œ (ì´ˆë‘íš¨ê³¼)</li>
<li>Primacy effect : ì´ˆë°˜ì—ëŠ” ìœ ì €ì˜ ë°˜ì‘ì´ ê·¹ì ì´ì§€ ì•Šì§€ë§Œ, ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ user learningì´ ë°œìƒí•˜ì—¬ ì²˜ì¹˜ ìµœì í™”ê°€ ì˜ ì´ë£¨ì–´ì§ˆë•Œ</li>
</ul>
<blockquote class="blockquote">
<p>ğŸ’¡ ì´ëŸ° ìš”ì¸ë“¤ì„ ì–´ë–»ê²Œ ë°œê²¬ í•´ì•¼í• ê¹Œ?<br>
(1) ì²˜ì¹˜ íš¨ê³¼ë¥¼ ë‹¤ì–‘í•œ ì„¸ê·¸ë¨¼íŠ¸ë¡œ ìª¼ê°œì–´ ê²°ê³¼ë¥¼ í™•ì¸í•´ë³¸ë‹¤.<br>
(2) ì²˜ì¹˜ì˜ íš¨ê³¼ë¥¼ ì¼ë³„ë¡œ ìª¼ê°œì–´ í™•ì¸í•´ë³¸ë‹¤.<br>
(3) ì‹¤í—˜ì˜ ê¸°ê°„ì„ ëŠ˜ë ¤ ì¥ê¸°ì ìœ¼ë¡œ í™•ì¸í•´ë³¸ë‹¤.</p>
</blockquote>
<ul>
<li><strong>ê²°ë¡ </strong>
<ul>
<li>ìš°ë¦¬ê°€ ì§„í–‰í•œ í…ŒìŠ¤íŠ¸ ì„¤ê³„ê°€ ì˜ë˜ì–´ìˆë‹¤ëŠ” êµ³ì€ ë¯¿ìŒì—ì„œ ë²—ì–´ë‚˜ ê²°ê³¼ë¥¼ ì£¼ì–´ì§„ ë¦¬ì†ŒìŠ¤ ì•ˆì—ì„œ ìµœëŒ€í•œ ë¹„íŒì ìœ¼ë¡œ í•´ì„í•´ì•¼í•œë‹¤.</li>
<li>A/B testë¥¼ ì§„í–‰í•  ë•Œ ë°œìƒí•  ìˆ˜ ìˆëŠ” êµë€ ë³€ìˆ˜ì˜ ë²”ìœ„ë¥¼ ì •í•œë‹¤ í•˜ë”ë¼ë„ ì„¸ë¶€ì ì¸ ë³€ìˆ˜ë“¤ì„ ëª¨ë‘ íŒŒì•…í•˜ê¸°ë€ í˜ë“¤ë‹¤. í•˜ì§€ë§Œ ìœ„ ë…¼ë¬¸ì—ì„œ ì†Œê°œí•œëŒ€ë¡œ ì—¬ëŸ¬ Metricì— ëŒ€í•´ ì •ì˜ë¥¼ ì§„í–‰í•˜ê³  ê²½í—˜ì ìœ¼ë¡œ ìŒ“ì¸ ë°œìƒ ê°€ëŠ¥í•œ ë³€ìˆ˜ë“¤ì— ëŒ€í•œ ê´€ë¦¬ ì‹œìŠ¤í…œì„ ì˜ êµ¬ì¶•í•œë‹¤ë©´ ë” ë°œì „ëœ ì¶”ë¡ ì„ í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.</li>
<li>A/B test ë¶„ì„ì„ ì§„í–‰í•˜ëŠ” ë¶„ì„ê°€ì˜ ë„ë©”ì¸ì— ëŒ€í•œ ì´í•´ë„, ì‚¬ì „ ì§€ì‹ì´ ì¤‘ìš”í•  ìˆ˜ ìˆë‹¤. ë„ë©”ì¸ ì§€ì‹ ì •ë„ì— ë”°ë¼ ì¶”ì¸¡í•  ìˆ˜ ìˆëŠ” êµë€ ë³€ìˆ˜ì˜ ë²”ìœ„ë„ ë„“ì–´ì§ˆ ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.</li>
</ul></li>
</ul>
</section>
<section id="sensitivity-analysis" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="sensitivity-analysis">Sensitivity analysis</h2>
<p>ì¼ë°˜ì ìœ¼ë¡œ&nbsp;ê´€ì°°&nbsp;ë°ì´í„°ë¡œ&nbsp;ì¸ê³¼ì¶”ë¡ &nbsp;ë¶„ì„ì„&nbsp;í• &nbsp;ë•Œì—ëŠ”&nbsp;ê´€ì¸¡ë˜ì§€&nbsp;ì•Šì€&nbsp;êµë€&nbsp;ìš”ì¸ì´&nbsp;ì—†ë‹¤ëŠ”&nbsp;ê°€ì •&nbsp;í•˜ì—ì„œ&nbsp;ë¶„ì„ì„&nbsp;ì§„í–‰í•©ë‹ˆë‹¤.&nbsp;ì¼ë°˜ì ìœ¼ë¡œ&nbsp;ì´ëŸ¬í•œ&nbsp;ê°€ì •ì€&nbsp;ë§Œì¡±ë &nbsp;ìˆ˜&nbsp;ì—†ìŠµë‹ˆë‹¤.&nbsp;ë”°ë¼ì„œ&nbsp;ê°€ì •ì´&nbsp;ìœ„ë°˜ë˜ì—ˆì„&nbsp;ë•Œ,&nbsp;ì¸ê³¼&nbsp;ê´€ê³„ì—&nbsp;ë¯¸ì¹˜ëŠ”&nbsp;ì˜í–¥ì„&nbsp;ì •ëŸ‰ì ìœ¼ë¡œ&nbsp;í™•ì¸í•˜ëŠ”&nbsp;ì ˆì°¨,&nbsp;ì¦‰&nbsp;ê°•ê±´ì„±ì„&nbsp;í™•ì¸í•˜ëŠ”&nbsp;ì ˆì°¨ê°€&nbsp;í•„ìš”í•©ë‹ˆë‹¤. ì´ê²ƒì„&nbsp;ì¸¡ì •í•˜ê¸°&nbsp;ìœ„í•´&nbsp;ë‹¤ìŒê³¼&nbsp;ê°™ì€&nbsp;ì§ˆë¬¸ì„&nbsp;í•´ë³¼&nbsp;ìˆ˜&nbsp;ìˆìŠµë‹ˆë‹¤.</p>
<p>ê´€ì°° ë°ì´í„°ë¡œ ì¶”ì •í•œ ì¸ê³¼íš¨ê³¼ë¥¼ <span class="math inline">\(0\)</span>ìœ¼ë¡œ ë§Œë“¤ê¸° ìœ„í•´ì„œ ê´€ì°°ë˜ì§€ ì•Šì€ êµë€ìš”ì¸ì´ <span class="math inline">\(T\)</span>ì™€ <span class="math inline">\(Y\)</span>ì— ì–¼ë§ˆë‚˜ ë§ì€ ì˜í–¥ì„ ë¼ì³ì•¼ í•˜ëŠ”ê°€? ë¯¼ê°ë„ë¶„ì„ì€ ì´ëŸ¬í•œ ì§ˆë¬¸ì— ë‹µì„ í•˜ê¸° ìœ„í•œ ì •ëŸ‰ì ì¸ ë¶„ì„ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.&nbsp;</p>
<section id="sensitivity-basiscs-in-linear-setting" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="sensitivity-basiscs-in-linear-setting">Sensitivity Basiscs in Linear Setting</h3>
<p>ë¨¼ì €&nbsp;ê°€ì¥&nbsp;ê°„ë‹¨í•œ&nbsp;ì„¸íŒ…ìœ¼ë¡œ&nbsp;linear&nbsp;settingì„&nbsp;ê³ ë ¤í•´ë³´ê² ìŠµë‹ˆë‹¤.&nbsp;ì˜¤ë¥¸ìª½&nbsp;ê·¸ë¦¼ì„&nbsp;ë³´ë©´&nbsp;<span class="math inline">\(W\)</span>ëŠ”&nbsp;ê´€ì°°ëœ&nbsp;êµë€ìš”ì¸ì´ê³ ,&nbsp;<span class="math inline">\(U\)</span>ëŠ”&nbsp;ê´€ì°°ë˜ì§€&nbsp;ì•Šì€&nbsp;êµë€ìš”ì¸ì„&nbsp;ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.&nbsp;<span class="math inline">\(U\)</span>ì˜&nbsp;íš¨ê³¼ë¥¼&nbsp;ë¬´ì‹œí–ˆì„&nbsp;ë•Œ,&nbsp;ë‚˜íƒ€ë‚˜ëŠ”&nbsp;í¸í–¥ì€&nbsp;ì–´ëŠ&nbsp;ì •ë„ì¼ê¹Œìš”?</p>

<div class="no-row-height column-margin column-container"><div class="">
<p><img src="img10.png" class="img-fluid"></p>
</div></div><p>linear&nbsp;settingì—ì„œ&nbsp;<span class="math inline">\(T\)</span>ì™€&nbsp;<span class="math inline">\(Y\)</span>ëŠ”&nbsp;ë‹¤ìŒê³¼&nbsp;ê°™ì´&nbsp;í‘œí˜„í• &nbsp;ìˆ˜&nbsp;ìˆìŠµë‹ˆë‹¤.</p>
<p><span class="math display">\[\begin{aligned} &amp;T := \alpha_w W + \alpha_u U \\ &amp;Y := \beta_w W + \beta_u U + \delta T \\ \end{aligned}\]</span></p>
<p>ë¨¼ì €&nbsp;<span class="math inline">\(T,&nbsp;\,&nbsp;U\)</span>ê°€&nbsp;ì£¼ì–´ì¡Œì„&nbsp;ë•Œë¥¼&nbsp;ê°€ì •í•˜ë©´,&nbsp;ATEëŠ”&nbsp;<span class="math inline">\(\delta\)</span>ë¡œ&nbsp;ê³„ì‚°ë©ë‹ˆë‹¤.</p>
<p><span class="math display">\[E[Y(1) - Y(0)] = E_{W, U}[E[Y|T=1,W,U] - E[Y|T=0, W, U]] = \delta\]</span></p>
<p>í•˜ì§€ë§Œ&nbsp;<span class="math inline">\(U\)</span>ëŠ”&nbsp;ê´€ì°°í• &nbsp;ìˆ˜&nbsp;ì—†ëŠ”&nbsp;êµë€ìš”ì¸ì´ë¯€ë¡œ,&nbsp;ì‹¤ì œë¡œëŠ”&nbsp;<span class="math inline">\(W\)</span>ë§Œ&nbsp;ì¡°ì •í• &nbsp;ìˆ˜&nbsp;ìˆìŠµë‹ˆë‹¤.&nbsp;ë”°ë¼ì„œ&nbsp;<span class="math inline">\(U\)</span>ì˜&nbsp;ì˜í–¥ìœ¼ë¡œ&nbsp;confounding&nbsp;biasê°€&nbsp;<span class="math inline">\(\frac{\beta_u}{\alpha_u}\)</span>&nbsp;ë§Œí¼&nbsp;ë°œìƒí•©ë‹ˆë‹¤.</p>
<blockquote class="blockquote">
<p><span class="math display">\[ E_W[E[Y|T=1, W]-E[Y|T=0, W]] - E_{W,U}[E[Y|T=1, W, U] - E[Y|T=0, W, U]] = \frac{\beta_u}{\alpha_u} \]</span></p>
</blockquote>
<p><span class="math inline">\(proof\)</span></p>
<p><span class="math display">\[ \begin{aligned} E_W[E[Y|T=t, W]] &amp;= E_W[E[\beta_w W + \beta_u U + \delta T|T=t, W]] \\ &amp;= E_W[\beta_w W + \beta_u E[U|T=t, W] + \delta t] \\ \newline &amp;=E_w \left[\beta_w W + \beta_u \frac{t-\alpha_w W}{\alpha_u} + \delta t\right] \\ &amp;=E_w \left[\beta_w W + \frac{\beta_u}{\alpha_u}t - \frac{\beta_u \alpha_w}{\alpha_u}W + \delta t\right] \\ &amp;=\beta_w E[W] + \frac{\beta_u}{\alpha_u}t - \frac{\beta_u \alpha_w}{\alpha_u}E[W] + \delta t \\ &amp;=\left(\delta + \frac{\beta_u}{\alpha_u}\right)t + \left(\beta_w - \frac{\beta_u \alpha_w}{\alpha_u}\right)E[W] \end{aligned} \]</span></p>
<p><span class="math display">\[ \begin{aligned} &amp;E_W[E[Y|T=1, W]-E[Y|T=0, W]] \\ &amp;= \left(\delta + \frac{\beta_u}{\alpha_u}\right)(1) + \left(\beta_w - \frac{\beta_u \alpha_w}{\alpha_u}\right)E[W] - \left[\left(\delta + \frac{\beta_u}{\alpha_u}\right)(0) + \left(\beta_w - \frac{\beta_u \alpha_w}{\alpha_u}\right)E[W]\right] \\ &amp;= \delta + \frac{\beta_u}{\alpha_u} \end{aligned}\]</span></p>
<p><span class="math display">\[ \begin{aligned} Bias &amp;= E_W[E[Y|T=1, W]-E[Y|T=0, W]] \\ &amp;- E_{W,U}[E[Y|T=1, W, U] - E[Y|T=0, W, U]] \\ &amp;= \delta + \frac{\beta_u}{\alpha_u} - \delta \\ &amp;= \frac{\beta_u}{\alpha_u} \end{aligned} \]</span></p>
</section>
<section id="sensitivity-contour-plots" class="level3">
<h3 class="anchored" data-anchor-id="sensitivity-contour-plots">Sensitivity Contour Plots</h3>
<p>true&nbsp;ATEì¸&nbsp;<span class="math inline">\(\delta\)</span>ëŠ”&nbsp;ì•„ë˜ì™€&nbsp;ê°™ì´&nbsp;ë‹¤ì‹œ&nbsp;ì •ë¦¬í• &nbsp;ìˆ˜&nbsp;ìˆìŠµë‹ˆë‹¤.</p>
<p><span class="math display">\[ E_W[E[Y|T=1, W]-E[Y|T=0, W]] = \delta + \frac{\beta_u}{\alpha_u} \]</span></p>
<p><span class="math display">\[\begin{aligned} \delta = E_W[E[Y|T=1, W]-E[Y|T=0, W]] - \frac{\beta_u}{\alpha_u} \end{aligned}\]</span></p>
<p>ì‹ì„&nbsp;í•œë²ˆ&nbsp;ë”&nbsp;í•´ì„í•´ë³´ë©´&nbsp;ë‹¤ìŒê³¼&nbsp;ê°™ìŠµë‹ˆë‹¤.</p>
<ul>
<li><span class="math inline">\(U\)</span>ì— ì˜í•´ ìƒê¸°ëŠ” biasì¸ <span class="math inline">\(\frac{\beta_u}{\alpha_u}\)</span>ì´ í¬ë‹¤ë©´ <span class="math inline">\(E_W[E[Y|T=1, W]-E[Y|T=0, W]]\)</span>ëŠ” ìƒì‡„ë˜ê³ , <span class="math inline">\(\delta\)</span>ëŠ” <span class="math inline">\(0\)</span>ì— ê°€ê¹Œì›Œì§</li>
<li><span class="math inline">\(U\)</span>ì— ì˜í•´ ìƒê¸°ëŠ” biasì¸ <span class="math inline">\(\frac{\beta_u}{\alpha_u}\)</span>ì´ ì‘ë‹¤ë©´ <span class="math inline">\(E_W[E[Y|T=1, W]-E[Y|T=0, W]]\)</span>ëŠ” í¬ê²Œ ë³€í™”í•˜ì§€ ì•Šê³ , <span class="math inline">\(\delta\)</span>ëŠ” <span class="math inline">\(E_W[E[Y|T=1, W]-E[Y|T=0, W]]\)</span>ê³¼ í° ì°¨ì´ê°€ ì—†ìŒ</li>
</ul>
<p>ì´ì—&nbsp;ëŒ€í•´ì„œ&nbsp;ê·¸ë˜í”„ë¡œ&nbsp;ë‚˜íƒ€ë‚´ë³´ë©´&nbsp;ë‹¤ìŒê³¼&nbsp;ê°™ìŠµë‹ˆë‹¤.</p>
<p><img src="img11.png" class="img-fluid"></p>
<p>ê·¸ë¦¼ì€&nbsp;(<span class="math inline">\(\frac{1}{\alpha_u}\)</span>,&nbsp;<span class="math inline">\(\beta_u\)</span>)ì—&nbsp;ë”°ë¥¸&nbsp;<span class="math inline">\(\delta\)</span>ì˜&nbsp;ë³€í™”&nbsp;ê·¸ë˜í”„ì…ë‹ˆë‹¤.&nbsp;ë¨¼ì €&nbsp;green&nbsp;curve&nbsp;ê°’ì„&nbsp;í•´ì„í•´ë³´ê² ìŠµë‹ˆë‹¤.&nbsp;<span class="math inline">\(E_W[E[Y|T=1,&nbsp;W]-E[Y|T=0,&nbsp;W]]=25\)</span>ë¡œ&nbsp;ê³ ì •í–ˆì„&nbsp;ë•Œ,&nbsp;<span class="math inline">\(\frac{1}{\alpha_u}&nbsp;=&nbsp;1\)</span>ì´ê³ ,&nbsp;<span class="math inline">\(\beta_u&nbsp;=&nbsp;25\)</span>ë¼ë©´&nbsp;<span class="math inline">\(\delta&nbsp;=&nbsp;0\)</span>ì´&nbsp;ë©ë‹ˆë‹¤. ë”°ë¼ì„œ&nbsp;green&nbsp;curveì¼&nbsp;ê²½ìš°&nbsp;(<span class="math inline">\(\frac{1}{\alpha_u}\)</span>,&nbsp;<span class="math inline">\(\beta_u\)</span>)ì˜&nbsp;ë³€í™”ì—&nbsp;ë”°ë¥¸&nbsp;<span class="math inline">\(\delta&nbsp;=&nbsp;0\)</span>&nbsp;ì¼&nbsp;ë•Œì—&nbsp;í•´ë‹¹í•˜ëŠ”&nbsp;ê³¡ì„ ì…ë‹ˆë‹¤.&nbsp;<span class="math inline">\(\delta&nbsp;=&nbsp;0\)</span>ì´ë¼ëŠ”&nbsp;ì˜ë¯¸ëŠ”&nbsp;ê´€ì°°ë˜ì§€&nbsp;ì•Šì€&nbsp;êµë€&nbsp;ìš”ì¸&nbsp;<span class="math inline">\(U\)</span>ì—&nbsp;ì˜í•´&nbsp;<span class="math inline">\(E_W[E[Y|T=1,&nbsp;W]-E[Y|T=0,&nbsp;W]]\)</span>ì„&nbsp;ì „ë¶€&nbsp;ì„¤ëª…í•œë‹¤ëŠ”&nbsp;ì˜ë¯¸ì™€&nbsp;ê°™ìœ¼ë©°,&nbsp;<span class="math inline">\(U\)</span>ëŠ”&nbsp;ê°•ë ¥í•œ&nbsp;êµë€ìš”ì¸ì´ë¼ê³ &nbsp;ë³¼&nbsp;ìˆ˜&nbsp;ìˆìŠµë‹ˆë‹¤. ê²°ë¡ ì ìœ¼ë¡œ&nbsp;green&nbsp;curveì—&nbsp;ê°€ê¹Œì›Œì§€ê±°ë‚˜&nbsp;í˜¹ì€&nbsp;green&nbsp;curveë¥¼&nbsp;ë„˜ì–´ì„¤&nbsp;ê²½ìš°&nbsp;êµë€ìš”ì¸ì—&nbsp;ì˜í•´&nbsp;ì˜í–¥ì„&nbsp;ë§ì´&nbsp;ë°›ìœ¼ë¯€ë¡œ,&nbsp;ê°•ê±´ì„±ì´&nbsp;ë–¨ì–´ì§„ë‹¤ê³ &nbsp;ë³¼&nbsp;ìˆ˜&nbsp;ìˆìŠµë‹ˆë‹¤. ì •ë¦¬í•˜ë©´,&nbsp;ê´€ì°°ë˜ì§€&nbsp;ì•Šì€&nbsp;êµë€ìš”ì¸ì´&nbsp;treatmentì™€&nbsp;outcomeì—&nbsp;ëŒ€í•´&nbsp;ë¯¸ì¹˜ëŠ”&nbsp;ì˜í–¥ì˜&nbsp;ë°©í–¥ì€&nbsp;ì•Œ&nbsp;ìˆ˜&nbsp;ì—†ìŠµë‹ˆë‹¤.&nbsp;ì´ì—&nbsp;ë”°ë¼&nbsp;ë¯¼ê°ë„&nbsp;ë¶„ì„ì—ì„œëŠ”&nbsp;ê´€ì°°ë˜ì§€&nbsp;ì•Šì€&nbsp;êµë€ìš”ì¸ì˜&nbsp;**í¬ê¸°**ë¥¼&nbsp;ê³ ë ¤í•©ë‹ˆë‹¤.&nbsp;ìœ„ì˜&nbsp;ê·¸ë¦¼&nbsp;ì˜ˆì‹œì²˜ëŸ¼&nbsp;ë¯¼ê°ë„&nbsp;ë¶„ì„ì„&nbsp;í†µí•´&nbsp;ì¶”ì •ëœ&nbsp;íš¨ê³¼ë¥¼&nbsp;ì—†ì•¨&nbsp;ì •ë„ë¡œ&nbsp;ì¶”ì •ëŸ‰ì„&nbsp;ë³€ê²½í•˜ë ¤ë©´&nbsp;ê´€ì°°ë˜ì§€&nbsp;ì•Šì€&nbsp;êµë€ìš”ì¸ì˜&nbsp;í¬ê¸°ê°€&nbsp;ì–´ëŠ&nbsp;ì •ë„ì—¬ì•¼&nbsp;í•˜ëŠ”ì§€ë¥¼&nbsp;í™•ì¸í• &nbsp;ìˆ˜&nbsp;ìˆê³ ,&nbsp;ë„ë©”ì¸&nbsp;ì§€ì‹ì„&nbsp;í™œìš©í•˜ì—¬&nbsp;ì¶”ì •ëœ&nbsp;íš¨ê³¼ì˜&nbsp;ê°•ê±´ì„±ì„&nbsp;<strong>ì£¼ê´€ì </strong>ìœ¼ë¡œ&nbsp;ê²°ì •í• &nbsp;ìˆ˜&nbsp;ìˆìŠµë‹ˆë‹¤.</p>
</section>
<section id="more-general-settings" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="more-general-settings">More General Settings</h3>
<p>ê°•ì˜ì—ì„œëŠ” ë” ì¼ë°˜ì ì¸ ë¯¼ê°ë„ ë¶„ì„ ë°©ë²•ì— ëŒ€í•´ ì†Œê°œí•©ë‹ˆë‹¤.&nbsp;</p>
<ol type="1">
<li><p><strong>Assess-ing Sensitivity to an Unobserved Binary Covariate in an Observational Study with Binary Outcome(1983)</strong></p></li>
<li><p><strong>Making sense of sensitivity: extending omitted variable bias(2020)</strong></p></li>
</ol>
<p>ì´ ì¤‘ ë‘ ë²ˆì§¸ ë…¼ë¬¸ì— ëŒ€í•´ì„œ ì§§ê²Œ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤.&nbsp;</p>
<p>ì´ ë…¼ë¬¸ì—ì„œëŠ” partial <span class="math inline">\(R^2\)</span>ë¥¼ í™œìš©í•´ì„œ linear regressionì—ì„œ ë¯¼ê°ë„ë¶„ì„ì„ ìˆ˜í–‰í•˜ê³  ë¦¬í¬íŒ…í•˜ê¸° ìœ„í•œ ìƒˆë¡œìš´ ë°©ì‹ì„ ì œì•ˆí•©ë‹ˆë‹¤.&nbsp;</p>
<p>**ì£¼ìš”&nbsp;ê¸°ì—¬ì‚¬í•­**</p>
<p>1.&nbsp;&nbsp;Robustness&nbsp;value&nbsp;ê°œë°œ</p>
<p>2.&nbsp;&nbsp;partial&nbsp;<span class="math inline">\(R^2\)</span>ë¥¼&nbsp;í™œìš©í•œ&nbsp;ë¯¼ê°ë„ë¶„ì„&nbsp;íˆ´&nbsp;ê°œë°œ</p>
<p>3.&nbsp;&nbsp;extreme&nbsp;scenarioì—&nbsp;ëŒ€í•œ&nbsp;ë¶„ì„&nbsp;ê·¸ë˜í”„&nbsp;ê°œë°œ</p>
<p>í•´ë‹¹&nbsp;ë…¼ë¬¸&nbsp;ì €ìê°€&nbsp;ê°œë°œí•œ&nbsp;íˆ´ì€&nbsp;R,&nbsp;Python,&nbsp;Stata&nbsp;ë“±ì—ì„œ&nbsp;ì´ìš©í• &nbsp;ìˆ˜&nbsp;ìˆìŠµë‹ˆë‹¤.</p>

<div class="no-row-height column-margin column-container"><div class="">
<ul>
<li>python :&nbsp;
<ul>
<li><a href="https://github.com/nlapier2/PySensemakr">PySensemakr</a></li>
<li><a href="https://www.pywhy.org/dowhy/v0.9.1/_modules/dowhy/causal_refuters/linear_sensitivity_analyzer.html#LinearSensitivityAnalyzer.robustness_value_func">pywhy</a></li>
</ul></li>
<li>R : sensemakr&nbsp;</li>
</ul>
</div></div><p>ë…¼ë¬¸ì—ì„œ ë‚˜ì˜¤ëŠ” exampleì´ ì§ê´€ì ì´ì§€ ì•Šì•„ì„œ ë‹¤ë¥¸ ë¸”ë¡œê·¸ ì˜ˆì‹œë¥¼ ì°¸ê³ í–ˆìŠµë‹ˆë‹¤.&nbsp;</p>
<ul>
<li>ì°¸ê³  : <a href="https://matteocourthoud.github.io/post/ovb/" class="uri">https://matteocourthoud.github.io/post/ovb/</a></li>
<li>êµìœ¡ê¸°ê°„ê³¼ ì„ê¸ˆ ì‚¬ì´ì˜ ê´€ê³„ì— ê´€ì‹¬ì´ ìˆìŒ</li>
<li>êµìœ¡ê¸°ê°„ê³¼ ì„ê¸ˆ ì‚¬ì´ì—ëŠ” ë§ì€ unobserved confounderê°€ ì¡´ì¬í•¨</li>
<li>ì˜ˆì‹œë¥¼ ìœ„í•´ unobserved confounderë¡œ abilityê°€ ìˆë‹¤ê³  ê°€ì •</li>
<li>abilityëŠ” omitted variableì´ì§€ë§Œ educationê³¼ wageì— ì˜í–¥ì„ ë¯¸ì¹œë‹¤ëŠ” ê²ƒì„ ì•Œê³  ìˆë‹¤ê³  ê°€ì •í•¨</li>
</ul>

<div class="no-row-height column-margin column-container"><div class="">
<p><img src="img12.png" class="img-fluid"></p>
</div></div><pre><code>library(sensemakr)
library(tidyverse)</code></pre>
<pre><code>#setwd("./posts/2023-02-07-sensitivity-analysis")
df &lt;- read.csv("ex_data.csv")[, -1] %&gt;% 
    mutate(gender = as.factor(gender))
df %&gt;% head(2)

  age gender education wage
1  62   male         6 3800
2  44   male         8 4500</code></pre>
<pre><code>fit &lt;- lm(wage ~ ., df)
summary(fit)

Call:
lm(formula = sleep_total ~ ., data = dat)

Residuals:
    Min      1Q  Median      3Q     Max 
-4.7435 -2.6495  0.0466  1.3376  7.0845 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 12.618464   0.862433  14.631 4.59e-11 ***
brainwt     -9.246523  14.305157  -0.646    0.527    
bodywt      -0.009216   0.013960  -0.660    0.518    
---
Signif. codes:  0 â€˜***â€™ 0.001 â€˜**â€™ 0.01 â€˜*â€™ 0.05 â€˜.â€™ 0.1 â€˜ â€™ 1

Residual standard error: 3.476 on 17 degrees of freedom
Multiple R-squared:  0.4766,    Adjusted R-squared:  0.4151 
F-statistic: 7.741 on 2 and 17 DF,  p-value: 0.004072</code></pre>
<p>íšŒê·€ë¶„ì„ ê²°ê³¼, ì¶”ì •ëœ ATEëŠ” ì•½&nbsp;96ìœ¼ë¡œ, êµìœ¡ ê¸°ê°„ì´ í•œ ë‹¨ìœ„ ì¦ê°€í•  ë•Œ, ì„ê¸ˆì€ ì•½ 96 ì¦ê°€í•©ë‹ˆë‹¤(education =&nbsp;95.94). í•˜ì§€ë§Œ ì‹¤ì œë¡œëŠ” ê´€ì°°ë˜ì§€ ì•Šì€ êµë€ìš”ì¸(ability)ì´ ì¡´ì¬í•˜ë¯€ë¡œ, í•´ë‹¹ ì¶”ì •ëŸ‰ì€ í¸í–¥ ì¶”ì •ëŸ‰ì…ë‹ˆë‹¤(í•´ë‹¹ ë°ì´í„°ëŠ” ê°€ìƒì˜ ë°ì´í„°ì´ë¯€ë¡œ, ì‹¤ì œë¡œëŠ” ìˆ˜ ë§ì€ êµë€ìš”ì¸ì´ ì¡´ì¬í•©ë‹ˆë‹¤).</p>
<p>ê´€ì°°ë˜ì§€ ì•Šì€ êµë€ìš”ì¸ì˜ í¬ê¸°ì— ë”°ë¼ ì¶”ì •ëœ ATEì˜ ê°•ê±´ì„±ì„ ë¶„ì„í•˜ê¸° ìœ„í•´ ë¯¼ê°ë„ ë¶„ì„ì„ ìˆ˜í–‰í•´ë³´ê² ìŠµë‹ˆë‹¤. sensemakr íŒ¨í‚¤ì§€ì˜&nbsp;sensemakr()&nbsp;í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ ê°„ë‹¨íˆ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<pre><code>sens &lt;- sensemakr(model = fit, treatment = "education")
summary(sens)

Sensitivity Analysis to Unobserved Confounding

Model Formula: wage ~ age + gender + education

Null hypothesis: q = 1 and reduce = TRUE 
-- This means we are considering biases that reduce the absolute value of the current estimate.
-- The null hypothesis deemed problematic is H0:tau = 0 

Unadjusted Estimates of 'education': 
  Coef. estimate: 95.9437 
  Standard Error: 38.7521 
  t-value (H0:tau = 0): 2.4758 

Sensitivity Statistics:
  Partial R2 of treatment with outcome: 0.1176 
  Robustness Value, q = 1: 0.3044 
  Robustness Value, q = 1, alpha = 0.05: 0.0627 

Verbal interpretation of sensitivity statistics:

-- Partial R2 of the treatment with the outcome: an extreme confounder (orthogonal to the covariates) that explains 100% of the residual variance of the outcome, would need to explain at least 11.76% of the residual variance of the treatment to fully account for the observed estimated effect.

-- Robustness Value, q = 1: unobserved confounders (orthogonal to the covariates) that explain more than 30.44% of the residual variance of both the treatment and the outcome are strong enough to bring the point estimate to 0 (a bias of 100% of the original estimate). Conversely, unobserved confounders that do not explain more than 30.44% of the residual variance of both the treatment and the outcome are not strong enough to bring the point estimate to 0.

-- Robustness Value, q = 1, alpha = 0.05: unobserved confounders (orthogonal to the covariates) that explain more than 6.27% of the residual variance of both the treatment and the outcome are strong enough to bring the estimate to a range where it is no longer 'statistically different' from 0 (a bias of 100% of the original estimate), at the significance level of alpha = 0.05. Conversely, unobserved confounders that do not explain more than 6.27% of the residual variance of both the treatment and the outcome are not strong enough to bring the estimate to a range where it is no longer 'statistically different' from 0, at the significance level of alpha = 0.05.</code></pre>
<p>Unadjusted Estimates of â€™ education â€™:ëŠ” ê¸°ì¡´ íšŒê·€ë¶„ì„ ê²°ê³¼ì™€ ê°™ìŠµë‹ˆë‹¤. Sensitivity Statistics:ì„ ë³´ë©´ partial <span class="math inline">\(R^2\)</span>ì™€ Robustness Value(RV) ë“±ì´ í‘œê¸°ë©ë‹ˆë‹¤. ë˜í•œ í•´ë‹¹ ì§€í‘œì— ëŒ€í•œ í•´ì„ë„ í•¨ê»˜ ì œì‹œë©ë‹ˆë‹¤.</p>
<ul>
<li><span class="math inline">\(RV_1\)</span>&nbsp;: ì¸¡ì •ë˜ì§€ ì•Šì€ êµë¸ìš”ì¸ì´ êµìœ¡ê³¼ ì„ê¸ˆì˜ ì”ì°¨ ë³€ë™ì˜ 30.44%ë¥¼ ì„¤ëª…í•œë‹¤ë©´ ì¶”ì •ëŸ‰ì„ 0ìœ¼ë¡œ ë§Œë“¤ê¸° ì¶©ë¶„í•¨ or ì¶©ë¶„í•˜ì§€ ì•ŠìŒ</li>
</ul>
<p>30.44%ê°€ ì¶©ë¶„í•œì§€ or ì¶©ë¶„í•˜ì§€ ì•Šì€ì§€ëŠ” ë¶„ì„ê°€ì˜ íŒë‹¨ì— ì˜ì¡´í•©ë‹ˆë‹¤. ë˜ëŠ”&nbsp;benchmark_covariates&nbsp;ì˜µì…˜ì„ í†µí•´ ê´€ì°°ëœ <span class="math inline">\(X\)</span>&nbsp;ë³€ìˆ˜ì™€ ë¹„êµí•¨ìœ¼ë¡œì¨ ì¶”ê°€ì ì¸ í•´ì„ì„ í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<section id="robustness-value" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="robustness-value">&nbsp;Robustness value&nbsp;</h4>
<p><span class="math inline">\(RV_q\)</span>ëŠ”&nbsp;ì¶”ì •ëœ&nbsp;treatment&nbsp;effectì˜&nbsp;ì•½&nbsp;<span class="math inline">\((100&nbsp;\times&nbsp;q)\)</span>%ë¥¼&nbsp;ì„¤ëª…í•˜ê¸°&nbsp;ìœ„í•´ì„œ&nbsp;unobserved&nbsp;confounderì˜&nbsp;íš¨ê³¼ê°€&nbsp;ì–¼ë§ˆë‚˜&nbsp;ê°•ë ¥í•´ì•¼&nbsp;í•˜ëŠ”ì§€ë¥¼&nbsp;ì„¤ëª…í•˜ëŠ”&nbsp;ì§€í‘œì…ë‹ˆë‹¤.</p>

<div class="no-row-height column-margin column-container"><div class="">
<p><img src="img13.png" class="img-fluid"></p>
</div></div><p><span class="math inline">\(Z&nbsp;\sim&nbsp;Y\)</span>ì˜&nbsp;ì˜í–¥ê³¼&nbsp;<span class="math inline">\(Z&nbsp;\sim&nbsp;D\)</span>ì˜&nbsp;ì˜í–¥ì´&nbsp;ë™ì¼í•˜ë‹¤ê³ &nbsp;ê°€ì •í• &nbsp;ê²½ìš°&nbsp;<span class="math inline">\(RV_q\)</span>ë¥¼&nbsp;ìœ ë„í• &nbsp;ìˆ˜&nbsp;ìˆìŠµë‹ˆë‹¤.</p>
<p><span class="math inline">\(R^2_{Y\sim&nbsp;Z|X,&nbsp;D}&nbsp;=&nbsp;R^2_{D\sim&nbsp;Z|X}=RV_q\)</span>ì¼&nbsp;ë•Œ,</p>
<p><span class="math display">\[ \begin{aligned} RV_q&nbsp;=&nbsp;\frac{1}{2}(\sqrt{f^4_q&nbsp;+&nbsp;4f^2_q&nbsp;-&nbsp;f^2_q}),&nbsp;\quad&nbsp;f&nbsp;=&nbsp;q\cdot|\frac{t}{df}|\,\,&nbsp;(cohen's\,f) \end{aligned} \]</span></p>
<ul>
<li><span class="math inline">\(RV_q \approx 1\)</span>ì¼ ê²½ìš° <span class="math inline">\(Z\)</span>ê°€ <span class="math inline">\(Y\)</span>ì™€ <span class="math inline">\(D\)</span>ì˜ ëª¨ë“  ì”ì°¨ ë³€ë™ì„ ì„¤ëª…í•œë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•¨&nbsp; &nbsp;
<ul>
<li>strong confounder</li>
</ul></li>
<li><span class="math inline">\(RV_q \approx 0\)</span>ì¼ ê²½ìš° <span class="math inline">\(Z\)</span>ê°€ <span class="math inline">\(Y\)</span>ì™€ <span class="math inline">\(D\)</span>ì˜ ëª¨ë“  ì”ì°¨ ë³€ë™ì„ ì„¤ëª…í•˜ì§€ ëª»í•œë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•¨&nbsp; &nbsp; &nbsp;
<ul>
<li>weak confonder</li>
</ul></li>
</ul>
</section>
<section id="sensitivity-contour-plot" class="level4">
<h4 class="anchored" data-anchor-id="sensitivity-contour-plot">Sensitivity Contour plot&nbsp;</h4>
<p>Robustness ValueëŠ” <span class="math inline">\(R^2_{Y\sim Z|X, D} = R^2_{D\sim Z|X}\)</span>ì¼ ë•Œë¥¼ ê°€ì •í•˜ë¯€ë¡œ, <span class="math inline">\(R^2_{Y\sim Z|X, D} \neq R^2_{D\sim Z|X}\)</span>ì¼ ê²½ìš° ê·¸ë˜í”„ë¥¼ í†µí•´ ëŒ€ëµì ì¸ ì¶”ì´ë¥¼ íŒŒì•…í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.&nbsp;</p>
<pre><code>plot(sens, xlab = "Partial R^2 of ability with education", 
     ylab = "Partial $R^2$ of ability with wage")</code></pre>
<p><img src="img14.png" class="img-fluid"></p>
<p>ê·¸ë˜í”„ë¥¼&nbsp;ë³´ë©´&nbsp;UnadjustedëŠ”&nbsp;ê´€ì°°ë˜ì§€&nbsp;ì•Šì€&nbsp;êµë€ìš”ì¸(ability)ê°€&nbsp;ì˜í–¥ì„&nbsp;ì£¼ì§€&nbsp;ì•Šì„&nbsp;ë•Œë¥¼&nbsp;ì˜ë¯¸í•©ë‹ˆë‹¤.&nbsp;ì¦‰,&nbsp;íšŒê·€ë¶„ì„&nbsp;ê²°ê³¼ì™€&nbsp;ë™ì¼í•©ë‹ˆë‹¤.&nbsp;ìš°ì¸¡&nbsp;ìƒë‹¨ìœ¼ë¡œ&nbsp;ê°ˆìˆ˜ë¡&nbsp;ê´€ì°°ë˜ì§€&nbsp;ì•Šì€&nbsp;êµë€ìš”ì¸ì˜&nbsp;íš¨ê³¼ê°€&nbsp;ì¦ê°€í•˜ê³ ,&nbsp;ë¹¨ê°„ìƒ‰&nbsp;dot&nbsp;lineì—&nbsp;ë„ë‹¬í–ˆì„&nbsp;ë•Œ,&nbsp;<span class="math inline">\(\hat{\beta}_{education}&nbsp;=&nbsp;0\)</span>ì´&nbsp;ë©ë‹ˆë‹¤.&nbsp;</p>
<p>ê·¸ë˜í”„ë¥¼&nbsp;ë³´ë©´&nbsp;ë¹¨ê°„ìƒ‰&nbsp;dot&nbsp;line&nbsp;ìœ„ì—&nbsp;ìˆëŠ”&nbsp;ê°’ìœ¼ë¡œ&nbsp;<span class="math inline">\(R^2_{Y&nbsp;\sim&nbsp;Z|D,X}&nbsp;=&nbsp;0.3\)</span>,&nbsp;$&nbsp;R^2_{D&nbsp;\sim&nbsp;Z|X}&nbsp;=&nbsp;0.3$&nbsp;ì •ë„ë¡œ&nbsp;ìƒê°í•´ë³¼&nbsp;ìˆ˜&nbsp;ìˆìŠµë‹ˆë‹¤.&nbsp;ë…¼ë¬¸ì—ì„œ&nbsp;ìœ ë„í•œ&nbsp;ê³µì‹ì„&nbsp;ì´ìš©í•´ì„œ&nbsp;bias&nbsp;ì¶”ì •ì¹˜ë¥¼&nbsp;êµ¬í•´ë³´ê³ &nbsp;í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.&nbsp;</p>
<p>ë…¼ë¬¸ì—ì„œ&nbsp;partial&nbsp;<span class="math inline">\(R^2\)</span>ë¥¼&nbsp;ì´ìš©í•´ì„œ&nbsp;ìœ ë„í•œ&nbsp;bias&nbsp;ì¶”ì •ì¹˜ëŠ”&nbsp;ë‹¤ìŒê³¼&nbsp;ê°™ìŠµë‹ˆë‹¤.&nbsp;</p>
<p><span class="math display">\[ |\hat{bias}|&nbsp;=&nbsp;\sqrt{\frac{R^2_{Y&nbsp;\sim&nbsp;Z|D,X}&nbsp;\cdot&nbsp;R^2_{D&nbsp;\sim&nbsp;Z|X}}{1&nbsp;-&nbsp;R^2_{D&nbsp;\sim&nbsp;Z|X}}}&nbsp;\cdot&nbsp;\frac{sd(Y^{\perp&nbsp;X,&nbsp;D})}{sd(D^{\perp&nbsp;X})} \]</span></p>
<pre><code>R_YZ = 0.3
R_DZ = 0.3 

DperpX &lt;- lm(education ~ age + gender, df)$residuals
YperpXD &lt;- lm(wage ~ ., df)$residuals

bias &lt;- sqrt((R_YZ*R_DZ/(1 - R_DZ)))*(sd(YperpXD)/sd(DperpX))

95.94 - bias

[1] 1.697537</code></pre>
<p><span class="math inline">\(\hat{\beta}_{education}&nbsp;=&nbsp;95.94\)</span>ì´ê³ ,&nbsp;<span class="math inline">\(|\hat{bias}|&nbsp;=&nbsp;94.24\)</span>ì´ë¯€ë¡œ,&nbsp;ëŒ€ëµ&nbsp;<span class="math inline">\(0\)</span>ì—&nbsp;ê°€ê¹Œìš´&nbsp;ê²ƒì„&nbsp;í™•ì¸í• &nbsp;ìˆ˜&nbsp;ìˆìŠµë‹ˆë‹¤.&nbsp;</p>
</section>
<section id="sensitivity-contour-plot-using-benchmark-covariates" class="level4">
<h4 class="anchored" data-anchor-id="sensitivity-contour-plot-using-benchmark-covariates">Sensitivity&nbsp;contour&nbsp;plot&nbsp;using&nbsp;benchmark&nbsp;covariates&nbsp;</h4>
<p>sensitivity contour plotì„ ë´¤ì„ ë•Œ, ê´€ì°°ë˜ì§€ ì•Šì€ êµë€ìš”ì¸ì˜ treatmentì™€ outcomeì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì— ë”°ë¥¸ bias íš¨ê³¼ë¥¼ í™•ì¸í•´ë³¼ ìˆ˜ ìˆì§€ë§Œ, ì‹¤ì œë¡œ ì´ biasê°€ í°ì§€ í˜¹ì€ ì‘ì€ì§€ëŠ” ì£¼ê´€ì ì¸ íŒë‹¨ì— ì˜ì¡´í•©ë‹ˆë‹¤. ì¦‰, ì´ì „ ì˜ˆì‹œì—ì„œ <span class="math inline">\(R^2_{Y \sim Z|D,X} = 0.3\)</span>, <span class="math inline">\(R^2_{D \sim Z|X} = 0.3\)</span> ì¼ ë•Œ, ì¶”ì •ëœ íšŒê·€ê³„ìˆ˜ëŠ” <span class="math inline">\(0\)</span>ì´ ë˜ë§Œ, <span class="math inline">\(R^2_{Y \sim Z|D,X} = 0.3\)</span>, <span class="math inline">\(R^2_{D \sim Z|X} = 0.3\)</span> ê°’ì´ í°ì§€ í˜¹ì€ ì‘ì€ì§€ì˜ ê¸°ì¤€ì€ ì•Œ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.&nbsp;</p>
<p>ì´ëŸ¬í•œ ê¸°ì¤€ ì„¤ì •ì˜ ì–´ë ¤ì›€ì„ ê·¹ë³µí•˜ê¸° ìœ„í•´ì„œ ê´€ì°°ëœ ì„¤ëª…ë³€ìˆ˜ë¥¼ ë²¤ì¹˜ë§ˆí¬í•˜ì—¬ ê´€ì°°ë˜ì§€ ì•Šì€ êµë€ìš”ì¸ì´ ë¯¸ì¹˜ëŠ” ì˜í–¥ì˜ í¬ê¸°ë¥¼ ëŒ€ëµì ìœ¼ë¡œ ì¶”ì¸¡í•©ë‹ˆë‹¤.&nbsp;</p>
<p><span class="math display">\[ \begin{aligned} k_D&nbsp;:=&nbsp;\frac{R^2_{D&nbsp;\sim&nbsp;Z|X_{-j}}}{R^2_{D&nbsp;\sim&nbsp;X_j|X_{-j}}},&nbsp;\quad k_Y&nbsp;:=&nbsp;\frac{R^2_{Y&nbsp;\sim&nbsp;Z|X_{-j},&nbsp;D}}{R^2_{Y&nbsp;\sim&nbsp;X_j|X_{-j},&nbsp;D}} \end{aligned} \]</span></p>
<p><span class="math inline">\(k_D \ge 1\)</span>ì¼ ë•Œ, <span class="math inline">\(R^2_{D \sim Z|X_{-j}} \ge R^2_{D \sim X_j|X_{-j}}\)</span>ì´ë¯€ë¡œ ê´€ì°°ë˜ì§€ ì•Šì€ êµë€ìš”ì¸ì´ ì‚¬ì „ì— ì§€ì •í•œ ì„¤ëª…ë³€ìˆ˜ ëŒ€ë¹„ Treatmentì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì´ í¬ë‹¤ëŠ” ì˜ë¯¸ë¡œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. <span class="math inline">\(k_Y \ge 1\)</span>ì¼ ë•Œë„ ë§ˆì°¬ê°€ì§€ë¡œ ê´€ì°°ë˜ì§€ ì•Šì€ êµë€ìš”ì¸ì´ ì‚¬ì „ì— ì§€ì •í•œ ì„¤ëª…ë³€ìˆ˜ ëŒ€ë¹„ ë°˜ì‘ë³€ìˆ˜ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì´ í¬ë‹¤ëŠ” ì˜ë¯¸ë¡œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<pre><code>sens2 &lt;- sensemakr(model = fit, treatment = "education", 
                  benchmark_covariates = "age", 
                  kd = c(0.5, 1, 2), 
                  ky = c(0.5, 1, 2))

plot(sens2)</code></pre>
<p><img src="img15.png" class="img-fluid"></p>
<p>sensemakr()&nbsp;í•¨ìˆ˜ì—ëŠ”&nbsp;`benchmark_covariates`&nbsp;ì˜µì…˜ì´&nbsp;ì¡´ì¬í•˜ë©°,&nbsp;<span class="math inline">\(k_D\)</span>,&nbsp;<span class="math inline">\(k_Y\)</span>ì˜&nbsp;í¬ê¸°ë¥¼&nbsp;ì‚¬ì „ì—&nbsp;ì§€ì •í• &nbsp;ìˆ˜&nbsp;ìˆìŠµë‹ˆë‹¤.&nbsp;ê·¸ë˜í”„ë¥¼&nbsp;í•´ì„í•´ë³´ë©´&nbsp;ê´€ì°°ë˜ì§€&nbsp;ì•Šì€&nbsp;êµë€ìš”ì¸(ability)ê°€&nbsp;ageì˜&nbsp;ë‘&nbsp;ë°°&nbsp;ì •ë„ì˜&nbsp;ì„¤ëª…ë ¥ì„&nbsp;ê°–ë”ë¼ë„,&nbsp;<span class="math inline">\(\hat{\beta}_{education}&nbsp;=&nbsp;67.61\)</span>ë¡œ&nbsp;ê°’ì˜&nbsp;ë³€í™”ëŠ”&nbsp;ìˆì§€ë§Œ&nbsp;ë¶€í˜¸ëŠ”&nbsp;ì—¬ì „íˆ&nbsp;positiveì¸&nbsp;ê²ƒì„&nbsp;ë³¼&nbsp;ìˆ˜&nbsp;ìˆìŠµë‹ˆë‹¤.&nbsp;</p>
<p>ì˜µì…˜ì„&nbsp;ì¶”ê°€í• &nbsp;ê²½ìš°&nbsp;í•´ë‹¹&nbsp;plotì—ì„œ&nbsp;í†µê³„ì &nbsp;ìœ ì˜ì„±&nbsp;ë˜í•œ&nbsp;ì²´í¬í•´ë³¼&nbsp;ìˆ˜&nbsp;ìˆìŠµë‹ˆë‹¤.&nbsp;</p>
<pre><code>plot(sens2, sensitivity.of = "t-value")</code></pre>
<p><img src="img16.png" class="img-fluid"></p>
<p>í†µê³„ì  ìœ ì˜ì„±ì„ ë³´ë©´ ê´€ì°°ë˜ì§€ ì•Šì€ êµë€ìš”ì¸(ability)ê°€ <span class="math inline">\(1 \times age\)</span>ë³´ë‹¤ ì•½ê°„ í° ì •ë„ì˜ ì„¤ëª…ë ¥ì„ ê°–ëŠ”ë‹¤ë©´, <span class="math inline">\(\hat{\beta}_{education}\)</span>ì´ í†µê³„ì ìœ¼ë¡œ ìœ ì˜í•˜ì§€ ì•Šê²Œ ë°”ë€” ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.&nbsp;</p>
<pre><code>plot(sens2)
add_bound_to_contour(r2dz.x = 0.3, 
                     r2yz.dx = 0.3, 
                     bound_label = "Something related to\nboth outcome and treatment")</code></pre>
<p><img src="img17.png" class="img-fluid"></p>
<p>ì¶”ê°€ì ìœ¼ë¡œ&nbsp;ì„ì˜ë¡œ&nbsp;partial&nbsp;<span class="math inline">\(R^2\)</span>ë¥¼&nbsp;ì„¤ì •í•´ì„œ&nbsp;ì ì„&nbsp;ì°ì–´ë³¼&nbsp;ìˆ˜ë„&nbsp;ìˆìŠµë‹ˆë‹¤.&nbsp;</p>
</section>
<section id="sensitivity-plots-of-extreme-scenarios" class="level4">
<h4 class="anchored" data-anchor-id="sensitivity-plots-of-extreme-scenarios">Sensitivity&nbsp;plots&nbsp;of&nbsp;extreme&nbsp;scenarios</h4>
<p>extreme&nbsp;scenarioëŠ”&nbsp;outcomeì˜&nbsp;ê±°ì˜&nbsp;ëª¨ë“ &nbsp;ì”ì°¨&nbsp;ë³€ë™ì„&nbsp;ê´€ì°°ë˜ì§€&nbsp;ì•Šì€&nbsp;êµë€ìš”ì¸ì´&nbsp;ì„¤ëª…í•œë‹¤ëŠ”&nbsp;ì˜ë¯¸ë¡œ,&nbsp;<span class="math inline">\(R_{Y&nbsp;\sim&nbsp;Z|D,X}&nbsp;=&nbsp;1\)</span>ì„&nbsp;ì˜ë¯¸í•©ë‹ˆë‹¤(ì˜µì…˜ìœ¼ë¡œ&nbsp;<span class="math inline">\(0.75,&nbsp;0.5\)</span>ì¼&nbsp;ë•Œë„&nbsp;í•¨ê»˜&nbsp;ì œì‹œë¨).&nbsp;ê·¸ë˜í”„ë¥¼&nbsp;í™œìš©í•˜ì—¬&nbsp;extreme&nbsp;scenarioì¼&nbsp;ë•Œ,&nbsp;<span class="math inline">\(R^2_{D&nbsp;\sim&nbsp;Z|X}\)</span>ì˜&nbsp;ë³€í™”ì—&nbsp;ë”°ë¼&nbsp;ì¶”ì •ëœ&nbsp;íšŒê·€ê³„ìˆ˜ê°€&nbsp;ì–´ë–»ê²Œ&nbsp;ë°”ë€ŒëŠ”ì§€ë¥¼&nbsp;ì‹œê°í™”í•´ë³¼&nbsp;ìˆ˜&nbsp;ìˆìŠµë‹ˆë‹¤.&nbsp;</p>
<pre><code>sens3 &lt;- sensemakr(model = fit, treatment = "education", 
                  benchmark_covariates = "age", 
                  kd = c(1, 2, 3, 4), 
                  ky = c(1, 2, 3, 4))
plot(sens3, type = "extreme", lim = 0.5)
result &lt;- plot(sens3, type = "extreme", lim = 0.5)</code></pre>
<p><img src="img18.png" class="img-fluid"></p>
<pre><code>result$scenario_r2yz.dx_1[117:119,]

    r2dz.x r2yz.dx adjusted_estimate
117  0.116       1         0.7348541
118  0.117       1         0.2712232
119  0.118       1        -0.1912156</code></pre>
<ul>
<li>&nbsp;x axis : <span class="math inline">\(R^2_{D \sim Z|X}\)</span>&nbsp;</li>
<li>y axis : <span class="math inline">\(\hat{\tau} = \hat{\tau}_{res} - \hat{bias}\)</span>&nbsp;</li>
<li>line : <span class="math inline">\(R^2_{Y \sim Z|D,X}\)</span></li>
</ul>
<p>ê·¸ë˜í”„ë¥¼&nbsp;ë³´ë©´&nbsp;ë¹¨ê°„ìƒ‰&nbsp;dot&nbsp;lineì€&nbsp;ì¶”ì •ëœ&nbsp;íšŒê·€ê³„ìˆ˜ê°€&nbsp;0ì´&nbsp;ë˜ëŠ”&nbsp;ê²½ìš°ì—&nbsp;í•´ë‹¹í•©ë‹ˆë‹¤.&nbsp;solid&nbsp;lineì€&nbsp;<span class="math inline">\(R^2_{Y&nbsp;\sim&nbsp;Z|D,X}&nbsp;=&nbsp;1\)</span>ì¼&nbsp;ë•Œì—&nbsp;í•´ë‹¹í•©ë‹ˆë‹¤.&nbsp;<span class="math inline">\(R^2_{Y&nbsp;\sim&nbsp;Z|D,X}&nbsp;=&nbsp;1\)</span>ì¼&nbsp;ë•Œ,&nbsp;ì¶”ì •ëœ&nbsp;íšŒê·€ê³„ìˆ˜ê°€&nbsp;0ì´&nbsp;ë˜ê¸°&nbsp;ìœ„í•´ì„œëŠ”&nbsp;<span class="math inline">\(R^2_{D&nbsp;\sim&nbsp;Z|X}&nbsp;\approx&nbsp;0.117\)</span>&nbsp;ì •ë„&nbsp;ë˜ì–´ì•¼&nbsp;í•˜ëŠ”&nbsp;ê²ƒì„&nbsp;í™•ì¸í• &nbsp;ìˆ˜&nbsp;ìˆìŠµë‹ˆë‹¤.&nbsp;&nbsp;</p>
<p>ë˜í•œ, ì™¼ìª½ í•˜ë‹¨ì— ë¹¨ê°„ìƒ‰ vertical lineì€ benchmarkë¡œ ì„¤ì •í•œ ë³€ìˆ˜ì— ë¹„í•´ confounderê°€ ëª‡ ë°° ë” ê°•ë ¥í•œì§€ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê²ƒìœ¼ë¡œ `kd = c(0.5, 1, 2)` ì˜µì…˜ì—ì„œ ì„¤ì •í•œ ê²ƒê³¼ ê°™ìŠµë‹ˆë‹¤.&nbsp;</p>
<p>ê´€ì°°ëœ ì„¤ëª…ë³€ìˆ˜ ageê°€ educationì— ë¯¸ì¹˜ëŠ” íš¨ê³¼ì— ë¹„í•´ì„œ ê´€ì°°ë˜ì§€ ì•Šì€ êµë€ìš”ì¸ì´ educationì— ë¯¸ì¹˜ëŠ” íš¨ê³¼ê°€ ë„¤ ë°° ì •ë„ í´ ë•Œ, <span class="math inline">\(\hat{\beta}_{education} \approx 0\)</span>ì´ ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&nbsp;</p>
<p>ìƒì‹ì ìœ¼ë¡œ&nbsp;êµìœ¡ê¸°ê°„ê³¼&nbsp;ë‚˜ì´ëŠ”&nbsp;ì¶©ë¶„í•œ&nbsp;ì–‘ì˜&nbsp;ìƒê´€ê´€ê³„ê°€&nbsp;ì¡´ì¬í•œë‹¤ê³ &nbsp;ìƒê°í• &nbsp;ìˆ˜&nbsp;ìˆìŠµë‹ˆë‹¤.&nbsp;ë”°ë¼ì„œ&nbsp;ê´€ì°°ëœ&nbsp;ì„¤ëª…ë³€ìˆ˜&nbsp;ageê°€&nbsp;educationì—&nbsp;ë¯¸ì¹˜ëŠ”&nbsp;íš¨ê³¼ì—&nbsp;ë¹„í•´ì„œ&nbsp;ê´€ì°°ë˜ì§€&nbsp;ì•Šì€&nbsp;êµë€ìš”ì¸ì´&nbsp;educationì—&nbsp;ë¯¸ì¹˜ëŠ”&nbsp;íš¨ê³¼ê°€&nbsp;ë„¤&nbsp;ë°°ì •ë„&nbsp;í´&nbsp;ë•Œ,&nbsp;<span class="math inline">\(\hat{\beta}_{education}&nbsp;\approx&nbsp;0\)</span>ì´&nbsp;ëœë‹¤ëŠ”&nbsp;ì˜ë¯¸ëŠ”&nbsp;ATE&nbsp;ì¶”ì •ëŸ‰ì´&nbsp;ì¶©ë¶„íˆ&nbsp;ì‹ ë¢°í• &nbsp;ìˆ˜&nbsp;ìˆê³ ,&nbsp;ê´€ì°°ë˜ì§€&nbsp;ì•Šì€&nbsp;êµë€ìš”ì¸ì—&nbsp;ê°•ê±´í•˜ë‹¤ëŠ”&nbsp;ê²ƒì„&nbsp;ì˜ë¯¸í•œë‹¤ê³ &nbsp;ë³¼&nbsp;ìˆ˜&nbsp;ìˆìŠµë‹ˆë‹¤(<strong>ì£¼ê´€ì ì¸ í•´ì„</strong>).&nbsp;&nbsp;</p>
</section>
<section id="pywhy-tutorial" class="level4">
<h4 class="anchored" data-anchor-id="pywhy-tutorial">pywhy tutorial&nbsp;</h4>
<pre><code>import dowhy
from dowhy import CausalModel
import pandas as pd
import numpy as np
import dowhy.datasets
import os
from dowhy import CausalModel</code></pre>
<pre><code>dat = pd.read_csv("posts/2023-02-07-sensitivity-analysis/ex_data.csv", index_col = 0)
dat.head()</code></pre>
<pre><code>gdot = """graph[directed 1 node[id "age" label "age"]
                    node[id "gender" label "gender"]
                    node[id "education" label "education"]
                    node[id "wage" label "wage"]
                    
                    edge[source "education" target "wage"]
                    edge[source "gender" target "wage"]
                    edge[source "age" target "wage"]]"""</code></pre>
<pre><code>model = CausalModel(
            data = dat,
            treatment="education",
            outcome="wage", 
            graph = gdot
        )</code></pre>
<pre><code>identified_estimand = model.identify_effect(proceed_when_unidentifiable=True)
print(identified_estimand)</code></pre>
<pre><code>estimate = model.estimate_effect(identified_estimand,
                                 method_name="backdoor.linear_regression")</code></pre>
<pre><code>refute = model.refute_estimate(identified_estimand, 
                               estimate,
                               method_name = "add_unobserved_common_cause",
                               simulated_method_name = "linear-partial-R2",
                               benchmark_common_causes = "age",
                               effect_fraction_on_treatment = [ 1,2,3]
                              )</code></pre>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>